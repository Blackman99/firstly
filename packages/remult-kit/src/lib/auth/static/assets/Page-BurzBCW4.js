var _i=Object.defineProperty;var Oi=(r,e,t)=>e in r?_i(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>(Oi(r,typeof e!="symbol"?e+"":e,t),t);import{n as fe,s as Ii,r as vt,a as kt,i as Ei,g as Ci,S as tt,b as nt,c as Zn,d as K,e as er,v as He,f as Ve,h as rt,j as Cn,k as Ft,o as Sn,l as Pt,m as Si,p as tr,q as nr,t as z,u as ie,w as Ti,x as ae,y as Ai,z as X,A as rr,B as ir,C as sr,D as xt,E as Tn,F as Fi,G as x,H as An,I as U,J as _t,K as Le,L as Pi,M as ce,N as te,O as B,P as or,Q as ye,R as Re,T as ar,U as yt,V as we,W as be,X as ve}from"./index-CoXFAOeJ.js";function Di(r,e){const t={},n={},i={$$scope:1};let s=r.length;for(;s--;){const o=r[s],a=e[s];if(a){for(const l in o)l in a||(n[l]=1);for(const l in a)i[l]||(t[l]=a[l],i[l]=1);r[s]=a}else for(const l in o)i[l]=1}for(const o in n)o in t||(t[o]=void 0);return t}const Ae=[];function an(r,e){return{subscribe:Ye(r,e).subscribe}}function Ye(r,e=fe){let t;const n=new Set;function i(a){if(kt(r,a)&&(r=a,t)){const l=!Ae.length;for(const u of n)u[1](),Ae.push(u,r);if(l){for(let u=0;u<Ae.length;u+=2)Ae[u][0](Ae[u+1]);Ae.length=0}}}function s(a){i(a(r))}function o(a,l=fe){const u=[a,l];return n.add(u),n.size===1&&(t=e(i,s)||fe),a(r),()=>{n.delete(u),n.size===0&&t&&(t(),t=null)}}return{set:i,update:s,subscribe:o}}function it(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return an(t,(o,a)=>{let l=!1;const u=[];let f=0,d=fe;const p=()=>{if(f)return;d();const k=e(n?u[0]:u,o,a);s?o(k):d=Ei(k)?k:fe},g=i.map((k,_)=>Ii(k,C=>{u[_]=C,f&=~(1<<_),l&&p()},()=>{f|=1<<_}));return l=!0,p(),function(){vt(g),d(),l=!1}})}const Ri=r=>{const{subscribe:e,update:t}=Ye(r);return{subscribe:e,set:(n={})=>{t(i=>Object.assign(i,n))}}},Me=Ri({mode:"window",basePath:null}),Dt=(r=Ci(Me).mode)=>{let e="popstate";r==="window"&&(e="popstate"),r==="hash"&&(e="hashchange"),window.dispatchEvent(new Event(e))},Fn={go:(r=0)=>{history.go(r),Dt()},push:(r,e=null)=>{history.pushState(e,"",r),Dt()},replace:(r,e=null)=>{history.replaceState(e,"",r),Dt()}},Li=(r,e)=>e===null?r:r.startsWith(e)?r.slice(e.length):r,Mi=r=>{const e=r.match(/^(\/[^?#]*)?/),t=r.match(/\?([^#]*)?/),n=r.match(/#(.*)?/);return{path:(e==null?void 0:e[1])||"/",query:t!=null&&t[1]?`?${t==null?void 0:t[1]}`:"",hash:n!=null&&n[1]?`#${n==null?void 0:n[1]}`:""}},Pn=()=>{const{pathname:r,search:e,hash:t}=document.location;return{path:r,query:e,hash:t}},Dn=()=>{let r=document.location.hash.substring(1);return r[0]!=="/"&&(r="/"+r),Mi(r)},Bi=an(Pn(),r=>{const e=()=>r(Pn());return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}),Ni=an(Dn(),r=>{const e=()=>r(Dn());return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),ln=it([Me,Bi,Ni],([r,e,t],n)=>{r.mode==="window"&&n(e),r.mode==="hash"&&n(t)}),ji=it(ln,r=>r.path);it(ln,r=>r.query);it(ln,r=>r.hash);const Rt=it([Me,ji],([r,e])=>Li(e,r.basePath)),Qe=r=>r.split(/(?=\/)/),lr=()=>{let r=0;return()=>r++},{Error:We}=er;function Ut(r){let e;const t=r[10].default,n=tr(t,r,r[9],null),i={c:function(){n&&n.c()},m:function(o,a){n&&n.m(o,a),e=!0},p:function(o,a){n&&n.p&&(!e||a&512)&&rr(n,t,o,o[9],e?sr(t,o[9],a,null):ir(o[9]),null)},i:function(o){e||(ie(n,o),e=!0)},o:function(o){ae(n,o),e=!1},d:function(o){n&&n.d(o)}};return K("SvelteRegisterBlock",{block:i,id:Ut.name,type:"if",source:"(96:0) {#if isRouteActive($pathWithoutBase, $route, $contextChildRoutes)}",ctx:r}),i}function Ht(r){let e=Vt(r[1],r[0],r[2]),t,n,i=e&&Ut(r);const s={c:function(){i&&i.c(),t=nr()},l:function(a){throw new We("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){i&&i.m(a,l),z(a,t,l),n=!0},p:function(a,[l]){l&7&&(e=Vt(a[1],a[0],a[2])),e?i?(i.p(a,l),l&7&&ie(i,1)):(i=Ut(a),i.c(),ie(i,1),i.m(t.parentNode,t)):i&&(Ti(),ae(i,1,1,()=>{i=null}),Ai())},i:function(a){n||(ie(i),n=!0)},o:function(a){ae(i),n=!1},d:function(a){a&&X(t),i&&i.d(a)}};return K("SvelteRegisterBlock",{block:s,id:Ht.name,type:"component",source:"",ctx:r}),s}const Rn=(r,e,t,n,i)=>{const s=(u,f,d)=>{const p=Qe(f).filter(g=>g!=="/").length;return(d??0)+(u?1:p)},o=(u,f)=>{const d={invalidPath:`<Route path="${u==null?void 0:u.path}" /> has invalid path. Path must start with '/'`,fallbackOutsideRoot:"<Route fallback /> cannot be outside root <Route />",pathOutsideRoot:`<Route path="${u==null?void 0:u.path}" /> cannot be outside root <Route />`,fallbackInsideFallback:"<Route fallback /> cannot be inside <Route fallback>",pathInsideFallback:`<Route path="${u==null?void 0:u.path}" /> cannot be inside <Route fallback>`};if(u.path[0]!=="/")throw new Error(d.invalidPath);if(u.root&&u.fallback)throw new Error(d.fallbackOutsideRoot);if(u.root&&u.path!=="/")throw new Error(d.pathOutsideRoot);if(f!=null&&f.fallback&&u.fallback)throw new Error(d.fallbackInsideFallback);if(f!=null&&f.fallback&&!u.fallback)throw new Error(d.pathInsideFallback)},a=s(t,n,i==null?void 0:i.depth),l={id:r,root:e,fallback:t,path:n,depth:a};return o(l,i),l},Ln=()=>{const{subscribe:r,update:e}=Ye([]);return{subscribe:r,update:t=>e(n=>[...n.filter(i=>t.id!==i.id),t]),remove:t=>e(n=>n.filter(i=>t.id!==i.id))}},Vt=(r,e,t)=>{const n=(u,f,d,p)=>{let g=Qe(u).filter(C=>C!=="/"),k=Qe(d).filter(C=>C!=="/"),_="";if(d==="/")return f||g.length===p;for(let C=p-k.length;C<p;C++)_=_+g[C];return d===_},i=(u,f,d)=>{var k,_,C,M;let p=Qe(u).filter(b=>b!=="/"),g=!1;for(let b=0;b<(d==null?void 0:d.length)&&!g;b++)(k=d[b])!=null&&k.fallback||(g=n(u,((_=d[b])==null?void 0:_.root)??!1,((C=d[b])==null?void 0:C.path)??"",((M=d[b])==null?void 0:M.depth)??0));return p.length>=f&&!g},{root:s,fallback:o,path:a,depth:l}=e;return o?i(r,l,t):n(r,s,a,l)},Mn=lr(),lt={},Lt={};function Ji(r,e,t){let n,i,s,o;He(Rt,"pathWithoutBase"),Ve(r,Rt,b=>t(1,s=b));let{$$slots:a={},$$scope:l}=e;rt("Route",a,["default"]);const u=Mn(),f=!Cn(lt);let{fallback:d=!1}=e,{path:p="/"}=e;const g=Ye();He(g,"route"),Ve(r,g,b=>t(0,n=b));const k=Ft(lt);He(k,"contextRoute"),Ve(r,k,b=>t(8,i=b));const _=Ln(),C=Ft(Lt);He(C,"contextChildRoutes"),Ve(r,C,b=>t(2,o=b)),Sn(()=>C==null?void 0:C.remove(n)),Pt(lt,g),Pt(Lt,_);const M=["fallback","path"];return Object.keys(e).forEach(b=>{!~M.indexOf(b)&&b.slice(0,2)!=="$$"&&b!=="slot"&&console.warn(`<Route> was created with unknown prop '${b}'`)}),r.$$set=b=>{"fallback"in b&&t(6,d=b.fallback),"path"in b&&t(7,p=b.path),"$$scope"in b&&t(9,l=b.$$scope)},r.$capture_state=()=>({writable:Ye,createIdIssuer:lr,getPathSegments:Qe,getRoute:Rn,createChildRoutes:Ln,isRouteActive:Vt,getId:Mn,routeContextKey:lt,childRoutesContextKey:Lt,onDestroy:Sn,getContext:Ft,setContext:Pt,hasContext:Cn,pathWithoutBase:Rt,id:u,root:f,fallback:d,path:p,route:g,contextRoute:k,childRoutes:_,contextChildRoutes:C,$route:n,$contextRoute:i,$pathWithoutBase:s,$contextChildRoutes:o}),r.$inject_state=b=>{"fallback"in b&&t(6,d=b.fallback),"path"in b&&t(7,p=b.path)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&448&&Si(g,n=Rn(u,f,d,p,i),n),r.$$.dirty&1&&(C==null||C.update(n))},[n,s,o,g,k,C,d,p,i,l,a]}class Ge extends tt{constructor(e){super(e),nt(this,e,Ji,Ht,Zn,{fallback:6,path:7}),K("SvelteRegisterComponent",{component:this,tagName:"Route",options:e,id:Ht.name})}get fallback(){throw new We("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set fallback(e){throw new We("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get path(){throw new We("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set path(e){throw new We("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Bn=r=>{var a;const e=(a=r.target)==null?void 0:a.closest("a[href]"),t=e==null?void 0:e.href;if(e===null||t===null)return!0;const n=["","true"].includes(e.getAttribute("data-handle-ignore")??"false"),i=(e.getAttribute("target")??"_self")!=="_self",s=r.metaKey||r.ctrlKey||r.altKey||r.shiftKey,o=new URL(t).origin!==document.location.origin;if(n||i||s||o)return!0;t===document.location.href?Fn.replace(t):Fn.push(t),r.preventDefault()},un=r=>(r.addEventListener("click",Bn),{destroy:()=>{r.removeEventListener("click",Bn)}}),qi="Users/jycouet/mdev/gh/lib/remult-kit/node_modules/.pnpm/svelte-micro@2.5.6_svelte@4.2.12/node_modules/svelte-micro/dist/lib/components/Link.svelte";function Wt(r){let e,t,n,i;const s=r[5].default,o=tr(s,r,r[4],null);let a=[{href:r[0]},r[1]],l={};for(let f=0;f<a.length;f+=1)l=xt(l,a[f]);const u={c:function(){e=x("a"),o&&o.c(),An(e,l),U(e,qi,15,0,417)},l:function(d){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(d,p){z(d,e,p),o&&o.m(e,null),t=!0,n||(i=[_t(un.call(null,e)),Le(e,"click",r[6],!1,!1,!1,!1)],n=!0)},p:function(d,[p]){o&&o.p&&(!t||p&16)&&rr(o,s,d,d[4],t?sr(s,d[4],p,null):ir(d[4]),null),An(e,l=Di(a,[(!t||p&1)&&{href:d[0]},p&2&&d[1]]))},i:function(d){t||(ie(o,d),t=!0)},o:function(d){ae(o,d),t=!1},d:function(d){d&&X(e),o&&o.d(d),n=!1,vt(i)}};return K("SvelteRegisterBlock",{block:u,id:Wt.name,type:"component",source:"",ctx:r}),u}const Nn=(r,e,t)=>(r==="hash"?"#":"")+(e??"")+t;function xi(r,e,t){let n;const i=["href"];let s=Tn(e,i),o;He(Me,"options"),Ve(r,Me,d=>t(3,o=d));let{$$slots:a={},$$scope:l}=e;rt("Link",a,["default"]);let{href:u}=e;r.$$.on_mount.push(function(){u===void 0&&!("href"in e||r.$$.bound[r.$$.props.href])&&console.warn("<Link> was created without expected prop 'href'")});function f(d){Pi.call(this,r,d)}return r.$$set=d=>{e=xt(xt({},e),Fi(d)),t(1,s=Tn(e,i)),"href"in d&&t(2,u=d.href),"$$scope"in d&&t(4,l=d.$$scope)},r.$capture_state=()=>({getFormatedHref:Nn,options:Me,linkHandle:un,href:u,formatedHref:n,$options:o}),r.$inject_state=d=>{"href"in e&&t(2,u=d.href),"formatedHref"in e&&t(0,n=d.formatedHref)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&12&&t(0,n=Nn(o.mode,o.basePath,u))},[n,s,u,o,l,a,f]}class fn extends tt{constructor(e){super(e),nt(this,e,xi,Wt,Zn,{href:2}),K("SvelteRegisterComponent",{component:this,tagName:"Link",options:e,id:Wt.name})}get href(){throw new Error("<Link>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set href(e){throw new Error("<Link>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}function st(r){r.focus()}const ut="src/lib/modules/auth/components/ForgottenPassword.svelte";function Kt(r){let e,t,n,i,s,o,a;const l={c:function(){e=x("div"),t=x("form"),n=x("input"),i=ce(),s=x("button"),s.textContent="Send password reset instructions",te(n,"type","text"),te(n,"placeholder","Your email address"),U(n,ut,21,8,437),U(s,ut,22,8,514),te(t,"class","s-YGXJmi8diuJx"),U(t,ut,20,4,422),te(e,"class","login"),U(e,ut,19,0,398)},l:function(f){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(f,d){z(f,e,d),B(e,t),B(t,n),B(t,i),B(t,s),o||(a=_t(st.call(null,n)),o=!0)},p:fe,i:fe,o:fe,d:function(f){f&&X(e),o=!1,a()}};return K("SvelteRegisterBlock",{block:l,id:Kt.name,type:"component",source:"",ctx:r}),l}function Ui(r,e,t){let{$$slots:n={},$$scope:i}=e;rt("ForgottenPassword",n,[]);let{remultKitData:s}=e;r.$$.on_mount.push(function(){s===void 0&&!("remultKitData"in e||r.$$.bound[r.$$.props.remultKitData])&&console.warn("<ForgottenPassword> was created without expected prop 'remultKitData'")});const o=["remultKitData"];return Object.keys(e).forEach(a=>{!~o.indexOf(a)&&a.slice(0,2)!=="$$"&&a!=="slot"&&console.warn(`<ForgottenPassword> was created with unknown prop '${a}'`)}),r.$$set=a=>{"remultKitData"in a&&t(0,s=a.remultKitData)},r.$capture_state=()=>({autofocus:st,remultKitData:s}),r.$inject_state=a=>{"remultKitData"in a&&t(0,s=a.remultKitData)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&1&&(s||t(0,s={props:{paths:{base:"/kit/auth",login:"/login",forgottenPassword:"/forgotten-password"}}}))},[s]}class ur extends tt{constructor(e){super(e),nt(this,e,Ui,Kt,kt,{remultKitData:0}),K("SvelteRegisterComponent",{component:this,tagName:"ForgottenPassword",options:e,id:Kt.name})}get remultKitData(){throw new Error("<ForgottenPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new Error("<ForgottenPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class ke{constructor(...e){c(this,"fields");c(this,"options");c(this,"target");c(this,"readonly");c(this,"allowNull");c(this,"dbReadOnly");c(this,"isServerExpression");c(this,"key");c(this,"caption");c(this,"inputType");c(this,"dbName");c(this,"valueType");this.fields=e}apiUpdateAllowed(e){throw new Error("Method not implemented.")}displayValue(e){throw new Error("Method not implemented.")}includedInApi(e){throw new Error("Method not implemented.")}toInput(e,t){throw new Error("Method not implemented.")}fromInput(e,t){throw new Error("Method not implemented.")}getDbName(){return Promise.resolve("")}getId(e){let t="";return this.fields.forEach(n=>{t.length>0&&(t+=","),t+=e[n.key]}),t}get valueConverter(){throw new Error("cant get value converter of compound id")}isEqualTo(e){let t={},i=e.toString().split(",");return this.fields.forEach((s,o)=>{t[s.key]=i[o]}),t}}function W(r,e=!0){var n;let t=r[De];if(!t&&e)throw new Error("item "+(((n=r.constructor)==null?void 0:n.name)||r)+" was not initialized using a context");return t}const De=Symbol.for("entityMember"),Hi=Symbol.for("entityInfo"),Vi=Symbol.for("entityInfo_key");function me(r,e=!0){if(r===void 0){if(e)throw new Error("Undefined is not an entity :)");return}let t=r[Hi];if(!t&&e)throw new Error(r.prototype.constructor.name+" is not a known entity, did you forget to set @Entity() or did you forget to add the '@' before the call to Entity?");return t}function Wi(r){return r[Vi]}const Ki=Symbol.for("relationInfo");function $i(r){return r==null?void 0:r[Ki]}const $t=Symbol.for("fieldRelationInfo");function H(r){return r[$t]}function Qi(r,e,t){for(const n of r.fields.toArray()){const i=$i(n.options);if(i&&!n[$t]){const s=i.toType(),o=e.repo(s,t),a=n.options;n[$t]={type:i.type,toEntity:s,options:a,toRepo:o,getFields:()=>{let l=a.field,u={fields:a.fields,compoundIdField:void 0};function f(g){return Error(`Error for relation: "${n.key}" to "${o.metadata.key}": `+g)}let d=()=>l||u.fields;if(i.type==="toMany"&&!d()){for(const g of o.fields.toArray())if(!d()){const k=H(g),_=g.options;if(k&&k.toEntity===r.metadata.entityType){if(k.type==="reference")l=g.key;else if(k.type==="toOne"){if(_.field)l=_.field;else if(_.fields){let C={};for(const M in _.fields)if(Object.prototype.hasOwnProperty.call(_.fields,M)){const b=_.fields[M];C[b]=M}u.fields=C}}}}if(!d())throw f("No matching field found on target. Please specify field/fields")}function p(g,k){const _=k.fields.find(g);if(!_)throw f(`Field "${g}" was not found in "${k.key}".`);return _}i.type==="reference"&&(l=n.key),l&&(i.type==="toOne"||i.type==="reference"?o.metadata.idMetadata.field instanceof ke?u.compoundIdField=l:u.fields={[o.metadata.idMetadata.field.key]:l}:r.metadata.idMetadata.field instanceof ke?u.compoundIdField=l:u.fields={[l]:r.metadata.idMetadata.field.key});for(const g in u.fields)Object.prototype.hasOwnProperty.call(u.fields,g)&&(p(g,o.metadata),p(u.fields[g],r.metadata));return u}}}}}class D{constructor(e){c(this,"apply");this.apply=e}static createCustom(e,t=""){let n={key:t,rawFilterTranslator:e};return Object.assign(i=>{if(i==null&&(i={}),!n.key)throw"Usage of custom filter before a key was assigned to it";return{[Ie+n.key]:i}},{rawFilterInfo:n})}static entityFilterToJson(e,t){return D.fromEntityFilter(e,t).toJson()}static entityFilterFromJson(e,t){return fr(e,{get:n=>t[n]})}static fromEntityFilter(e,t){let n=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let s=t[i];if(i=="$or")n.push(new Xi(...s.map(o=>D.fromEntityFilter(e,o))));else if(i=="$and")n.push(new jn(...s.map(o=>D.fromEntityFilter(e,o))));else if(i.startsWith(Ie))n.push(new D(o=>{o.custom(i.substring(Ie.length),s)}));else if(i==Yi)n.push(new D(o=>o.databaseCustom(s)));else{const o=e.fields[i],a=H(o),l=o.options;let u=(a==null?void 0:a.type)==="toOne"?l.fields?new zi(o,e.fields,l):new Gi(e.fields[l.field]):new mt(o),f=!1;if(s!==void 0&&s!=null){s.$id!==void 0&&(s=s.$id);for(const d in s)if(Object.prototype.hasOwnProperty.call(s,d)){const p=s[d];switch(d){case"$gte":case">=":n.push(u.isGreaterOrEqualTo(p)),f=!0;break;case"$gt":case">":n.push(u.isGreaterThan(p)),f=!0;break;case"$lte":case"<=":n.push(u.isLessOrEqualTo(p)),f=!0;break;case"$lt":case"<":n.push(u.isLessThan(p)),f=!0;break;case"$ne":case"!=":case"$nin":f=!0,Array.isArray(p)?n.push(u.isNotIn(p)):n.push(u.isDifferentFrom(p));break;case"$in":f=!0,n.push(u.isIn(p));break;case"$contains":f=!0,n.push(u.contains(p));break;case"$notContains":f=!0,n.push(u.notContains(p));break}}Array.isArray(s)&&(f=!0,n.push(u.isIn(s)))}!f&&s!==void 0&&n.push(u.isEqualTo(s))}}return new jn(...n)}__applyToConsumer(e){this.apply(e)}static async resolve(e){return typeof e=="function"?await e():e}toJson(){let e=new cn;return this.__applyToConsumer(e),e.result}static async translateCustomWhere(e,t,n){let i=new dn(async(s,o)=>{let a=[];for(const l in t.entityType){const u=t.entityType[l];u&&u.rawFilterInfo&&u.rawFilterInfo.rawFilterTranslator&&u.rawFilterInfo.key==s&&a.push(await D.fromEntityFilter(t,await u.rawFilterInfo.rawFilterTranslator(o,n)))}return a});return e.__applyToConsumer(i),await i.resolve(),e=new D(s=>i.applyTo(s)),e}}class mt{constructor(e){c(this,"metadata");this.metadata=e}processVal(e){if(me(this.metadata.valueType,!1)){if(!e){if(e===null&&!this.metadata.allowNull){const n=H(this.metadata);if((n==null?void 0:n.type)==="reference")return n.toRepo.metadata.idMetadata.field.options.valueType===Number?0:""}return null}return typeof e=="string"||typeof e=="number"?e:W(e).getId()}return e}contains(e){return new D(t=>t.containsCaseInsensitive(this.metadata,e))}notContains(e){return new D(t=>t.notContainsCaseInsensitive(this.metadata,e))}isLessThan(e){return e=this.processVal(e),new D(t=>t.isLessThan(this.metadata,e))}isGreaterOrEqualTo(e){return e=this.processVal(e),new D(t=>t.isGreaterOrEqualTo(this.metadata,e))}isNotIn(e){return new D(t=>{for(const n of e)t.isDifferentFrom(this.metadata,this.processVal(n))})}isDifferentFrom(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new D(t=>t.isNotNull(this.metadata)):new D(t=>t.isDifferentFrom(this.metadata,e))}isLessOrEqualTo(e){return e=this.processVal(e),new D(t=>t.isLessOrEqualTo(this.metadata,e))}isGreaterThan(e){return e=this.processVal(e),new D(t=>t.isGreaterThan(this.metadata,e))}isEqualTo(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new D(t=>t.isNull(this.metadata)):new D(t=>t.isEqualTo(this.metadata,e))}isIn(e){return e=e.map(t=>this.processVal(t)),(e==null?void 0:e.length)==1&&e[0]!=null&&e[0]!==null?new D(t=>t.isEqualTo(this.metadata,e[0])):new D(t=>t.isIn(this.metadata,e))}}class Gi extends mt{processVal(e){return e?typeof e=="string"||typeof e=="number"?e:W(e).getId():null}}class zi{constructor(e,t,n){c(this,"metadata");c(this,"fields");c(this,"relationOptions");this.metadata=e,this.fields=t,this.relationOptions=n}processVal(e){throw new Error("Invalid for Many To One Relation Field")}contains(e){throw new Error("Invalid for Many To One Relation Field")}notContains(e){throw new Error("Invalid for Many To One Relation Field")}isLessThan(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isNotIn(e){return new D(t=>{e.forEach(n=>this.isDifferentFrom(n).__applyToConsumer(t))})}isDifferentFrom(e){return new D(t=>{const n=[];for(const i in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,i)){const s=this.relationOptions.fields[i];n.push(new D(o=>new mt(this.fields.find(s)).isDifferentFrom(e[i]).__applyToConsumer(o)))}t.or(n)})}isLessOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterThan(e){throw new Error("Invalid for Many To One Relation Field")}isEqualTo(e){return new D(t=>{for(const n in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,n)){const i=this.relationOptions.fields[n];new mt(this.fields.find(i)).isEqualTo(e[n]).__applyToConsumer(t)}})}isIn(e){return new D(t=>{t.or(e.map(n=>this.isEqualTo(n)))})}}class jn extends D{constructor(...t){super(n=>{for(const i of this.filters)i&&i.__applyToConsumer(n)});c(this,"filters");this.filters=t}add(t){this.filters.push(t)}}class Xi extends D{constructor(...t){super(n=>{let i=this.filters.filter(s=>s!==void 0);i.length>1?n.or(i):i.length==1&&i[0].__applyToConsumer(n)});c(this,"filters");this.filters=t}}const Ie="$custom$",Yi="$db$",Qt="$an array";class cn{constructor(){c(this,"result",{});c(this,"hasUndefined",!1)}databaseCustom(e){throw new Error("database custom is not allowed with api calls.")}custom(e,t){Array.isArray(t)&&(t={[Qt]:t}),this.add(Ie+e,t)}add(e,t){t===void 0&&(this.hasUndefined=!0);let n=this.result;if(!n[e]){n[e]=t;return}let i=n[e];i instanceof Array?i.push(t):i=[i,t],n[e]=i}or(e){this.add("OR",e.map(t=>{let n=new cn;return t.__applyToConsumer(n),n.result}))}isNull(e){this.add(e.key+".null",!0)}isNotNull(e){this.add(e.key+".null",!1)}isIn(e,t){this.add(e.key+".in",t.map(n=>e.valueConverter.toJson(n)))}isEqualTo(e,t){this.add(e.key,e.valueConverter.toJson(t))}isDifferentFrom(e,t){this.add(e.key+".ne",e.valueConverter.toJson(t))}isGreaterOrEqualTo(e,t){this.add(e.key+".gte",e.valueConverter.toJson(t))}isGreaterThan(e,t){this.add(e.key+".gt",e.valueConverter.toJson(t))}isLessOrEqualTo(e,t){this.add(e.key+".lte",e.valueConverter.toJson(t))}isLessThan(e,t){this.add(e.key+".lt",e.valueConverter.toJson(t))}containsCaseInsensitive(e,t){this.add(e.key+".contains",t)}notContainsCaseInsensitive(e,t){this.add(e.key+".notContains",t)}}function fr(r,e){let t=[];[...r.fields].forEach(s=>{function o(l,u,f=!1,d=!1){let p=e.get(s.key+l);if(p!==void 0){let g=k=>{let _=k;if(f){let M;typeof k=="string"?M=JSON.parse(k):M=k,_=M.map(b=>d?b:s.valueConverter.fromJson(b))}else _=d?_:s.valueConverter.fromJson(_);let C=u(_);C!==void 0&&t.push({[s.key]:C})};if(!f&&p instanceof Array)p.forEach(k=>{g(k)});else{f&&typeof p=="string"&&(p=JSON.parse(p));const k=i(p);for(const _ of k)g(_)}}}o("",l=>l),o(".gt",l=>({$gt:l})),o(".gte",l=>({$gte:l})),o(".lt",l=>({$lt:l})),o(".lte",l=>({$lte:l})),o(".ne",l=>({$ne:l})),o(".in",l=>l,!0);var a=e.get(s.key+".null");if(a)switch(a=a.toString().trim().toLowerCase(),a){case"y":case"true":case"yes":t.push({[s.key]:null});break;default:t.push({[s.key]:{$ne:null}});break}o(".contains",l=>({$contains:l}),!1,!0),o(".notContains",l=>({$notContains:l}),!1,!0)});let n=e.get("OR");if(n){const o=i(n).map(a=>({$or:a.map(l=>fr(r,{get:u=>l[u]}))}));o.length==1?t.push(o[0]):t.push({$and:o})}for(const s in r.entityType){const o=r.entityType[s];if(o&&o.rawFilterInfo&&o.rawFilterInfo.rawFilterTranslator){let a=e.get(Ie+s);if(a!==void 0){const l=u=>{u[Qt]!=null&&(u=u[Qt]),t.push({[Ie+s]:u})};Array.isArray(a)?a.forEach(u=>l(u)):l(a)}}}if(t.length==1)return t[0];return{$and:t};function i(s){if(!Array.isArray(s))return[s];const o=[],a=[];for(const l of s)Array.isArray(l)?a.push(l):o.push(l);return a.push(o),a}}class dn{constructor(e){c(this,"translateCustom");c(this,"commands",[]);c(this,"promises",[]);this.translateCustom=e}applyTo(e){this.commands.forEach(t=>t(e))}or(e){let t;this.promises.push(Promise.all(e.map(async n=>{let i=new dn(this.translateCustom);return n.__applyToConsumer(i),await i.resolve(),new D(s=>i.applyTo(s))})).then(n=>{t=n})),this.commands.push(n=>n.or(t))}isEqualTo(e,t){this.commands.push(n=>n.isEqualTo(e,t))}isDifferentFrom(e,t){this.commands.push(n=>n.isDifferentFrom(e,t))}isNull(e){this.commands.push(t=>t.isNull(e))}isNotNull(e){this.commands.push(t=>t.isNotNull(e))}isGreaterOrEqualTo(e,t){this.commands.push(n=>n.isGreaterOrEqualTo(e,t))}isGreaterThan(e,t){this.commands.push(n=>n.isGreaterThan(e,t))}isLessOrEqualTo(e,t){this.commands.push(n=>n.isLessOrEqualTo(e,t))}isLessThan(e,t){this.commands.push(n=>n.isLessThan(e,t))}containsCaseInsensitive(e,t){this.commands.push(n=>n.containsCaseInsensitive(e,t))}notContainsCaseInsensitive(e,t){this.commands.push(n=>n.notContainsCaseInsensitive(e,t))}isIn(e,t){this.commands.push(n=>n.isIn(e,t))}custom(e,t){this.promises.push((async()=>{let n=await this.translateCustom(e,t);n&&(Array.isArray(n)?n.forEach(i=>i.__applyToConsumer(this)):n.__applyToConsumer(this))})())}databaseCustom(e){this.commands.push(t=>t.databaseCustom(e))}async resolve(){for(;this.promises.length>0;){let e=this.promises;this.promises=[],await Promise.all(e)}}}var Zi={};const Mt=Symbol.for("remult-static1");let Gt={defaultRemultFactory:void 0,remultFactory:void 0,defaultRemult:void 0,asyncContext:void 0,columnsOfType:new Map,allEntities:[],classHelpers:new Map,actionInfo:{allActions:[],runningOnServer:!1,runActionWithoutBlockingUI:r=>r(),startBusyWithProgress:()=>({progress:r=>{},close:()=>{}})},captionTransformer:void 0};typeof process<"u"&&Zi.IGNORE_GLOBAL_REMULT_IN_TESTS||typeof globalThis[Mt]>"u"?globalThis[Mt]=Gt:Gt=globalThis[Mt];const E=Gt;function es(){return E.defaultRemult||(E.defaultRemult=E.defaultRemultFactory()),E.defaultRemult}function cr(){E.remultFactory=()=>es()}cr();function Be(r){const e=r;if(typeof e[Ze]=="function")return e[Ze]();throw Error("Error getting repository internal from "+r)}const Ze=Symbol.for("getInternal");class ts{constructor(){c(this,"iAmRemultProxy",!0);c(this,"repoCache",new Map);c(this,"repo",(...e)=>{let t=E,n=this.repoCache.get(e[0]);n||this.repoCache.set(e[0],n=new Map);let i=n.get(e[1]);return i||(i={get fields(){return E.remultFactory().repo(...e).metadata.fields},[Ze](){return t.remultFactory().repo(...e)[Ze]()},relations:s=>t.remultFactory().repo(...e).relations(s),validate:(s,...o)=>t.remultFactory().repo(...e).validate(s,...o),addEventListener:(...s)=>t.remultFactory().repo(...e).addEventListener(...s),count:(...s)=>t.remultFactory().repo(...e).count(...s),create:(...s)=>t.remultFactory().repo(...e).create(...s),delete:s=>t.remultFactory().repo(...e).delete(s),find:(...s)=>t.remultFactory().repo(...e).find(...s),findFirst:(...s)=>t.remultFactory().repo(...e).findFirst(...s),findOne:(...s)=>t.remultFactory().repo(...e).findOne(...s),findId:(s,o)=>t.remultFactory().repo(...e).findId(s,o),toJson:s=>t.remultFactory().repo(...e).toJson(s),fromJson:(s,o)=>t.remultFactory().repo(...e).fromJson(s,o),getEntityRef:(...s)=>t.remultFactory().repo(...e).getEntityRef(...s),insert:s=>t.remultFactory().repo(...e).insert(s),liveQuery:(...s)=>t.remultFactory().repo(...e).liveQuery(...s),get metadata(){return E.remultFactory().repo(...e).metadata},query:(...s)=>t.remultFactory().repo(...e).query(...s),save:s=>t.remultFactory().repo(...e).save(s),update:(s,o)=>t.remultFactory().repo(...e).update(s,o)},n.set(e[1],i),i)})}get liveQuerySubscriber(){return E.remultFactory().liveQuerySubscriber}set liveQuerySubscriber(e){E.remultFactory().liveQuerySubscriber=e}get liveQueryStorage(){return E.remultFactory().liveQueryStorage}set liveQueryStorage(e){E.remultFactory().liveQueryStorage=e}get liveQueryPublisher(){return E.remultFactory().liveQueryPublisher}set liveQueryPublisher(e){E.remultFactory().liveQueryPublisher=e}call(e,t,...n){return E.remultFactory().call(e,t,...n)}get context(){return E.remultFactory().context}get dataProvider(){return E.remultFactory().dataProvider}set dataProvider(e){E.remultFactory().dataProvider=e}get repCache(){return E.remultFactory().repCache}authenticated(){return E.remultFactory().authenticated()}isAllowed(e){return E.remultFactory().isAllowed(e)}isAllowedForInstance(e,t){return E.remultFactory().isAllowedForInstance(e,t)}clearAllCache(){return E.remultFactory().clearAllCache()}get user(){return E.remultFactory().user}set user(e){E.remultFactory().user=e}get apiClient(){return E.remultFactory().apiClient}set apiClient(e){E.remultFactory().apiClient=e}get subscriptionServer(){return E.remultFactory().subscriptionServer}set subscriptionServer(e){E.remultFactory().subscriptionServer=e}}const Ke=new ts;function ns(r){return r.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace("Email","eMail").replace(" I D"," ID")}class rs{constructor(e,t,n){c(this,"repository");c(this,"isReferenceRelation");c(this,"allowNull");c(this,"storedItem");c(this,"id");this.repository=e,this.isReferenceRelation=t,this.allowNull=n}toJson(){if(this.storedItem)return this.item===null?null:this.repository.toJson(this.item)}setId(e){this.repository.metadata.idMetadata.field.valueType==Number&&(e=+e),this.id=e}waitLoadOf(e){return e==null?null:Be(this.repository).getCachedByIdAsync(e,!1)}get(e){if(e==null)return null;const t=Be(this.repository).getCachedById(e,this.isReferenceRelation);return this.isReferenceRelation&&!this.storedItem?!this.allowNull&&(this.id===0||this.id==="")?null:void 0:t}set(e){if(e===null&&!this.allowNull&&this.isReferenceRelation&&(this.id==0||this.id=="")){this.storedItem={item:null};return}if(this.storedItem=void 0,e)if(typeof e=="string"||typeof e=="number")this.id=e;else{let t=W(e,!1);t&&!this.isReferenceRelation?(Be(this.repository).addToCache(e),this.id=t.getId()):(this.storedItem={item:e},this.id=e[this.repository.metadata.idMetadata.field.key])}else e===null?this.id=null:this.id=void 0}get item(){return this.storedItem?this.storedItem.item:this.get(this.id)}async waitLoad(){return this.waitLoadOf(this.id)}}class Jn{constructor(e){c(this,"url");this.url=e}add(e,t){this.url.indexOf("?")>=0?this.url+="&":this.url+="?",this.url+=encodeURIComponent(e)+"="+encodeURIComponent(t)}addObject(e,t=""){if(e!=null)for(var n in e){let i=e[n];this.add(n+t,i)}}}function Ot(r){if(!r)return new qn;let e;return e||dr(r)&&(e=new is(r)),e||typeof r=="function"&&(e=new qn(r)),e}function dr(r){let e=r;return!!(e&&e.get&&e.put&&e.post&&e.delete)}class is{constructor(e){c(this,"http");this.http=e}async post(e,t){return await gt(()=>ft(this.http.post(e,t)))}delete(e){return ft(this.http.delete(e))}put(e,t){return ft(this.http.put(e,t))}async get(e){return await gt(()=>ft(this.http.get(e)))}}async function gt(r){var t,n,i,s;let e=0;for(;;)try{return await r()}catch(o){if(((t=o.message)!=null&&t.startsWith("Error occurred while trying to proxy")||(n=o.message)!=null&&n.startsWith("Error occured while trying to proxy")||(i=o.message)!=null&&i.includes("http proxy error")||(s=o.message)!=null&&s.startsWith("Gateway Timeout")||o.status==500)&&e++<50){await new Promise((a,l)=>{setTimeout(()=>{a({})},250)});continue}throw o}}function ft(r){let e;return r.toPromise!==void 0?e=r.toPromise():e=r,e.then(t=>t&&(t.status==200||t.status==201)&&t.headers&&t.request&&t.data?t.data:t).catch(async t=>{throw await ss(t)})}async function ss(r){var s,o,a;let e=await r;var t;e.error?t=e.error:e.isAxiosError&&(typeof((s=e.response)==null?void 0:s.data)=="string"?t=e.response.data:t=(o=e==null?void 0:e.response)==null?void 0:o.data),t||(t=e.message),e.status==0&&e.error.isTrusted&&(t="Network Error"),typeof t=="string"&&(t={message:t}),e.modelState&&(t.modelState=e.modelState);let n=e.status;n===void 0&&(n=(a=e.response)==null?void 0:a.status),n!=null&&(t.httpStatusCode=n);var i=Object.assign(t,{});return i}class hr{constructor(e){c(this,"apiProvider");c(this,"isProxy",!0);this.apiProvider=e}getEntityDataProvider(e){return new os(()=>{var n;let t=(n=this.apiProvider())==null?void 0:n.url;return t==null&&(t="/api"),t+"/"+e.key},()=>Ot(this.apiProvider().httpClient),e)}async transaction(e){throw new Error("Method not implemented.")}}function hn(r,e){if(r.include){let t={};for(const n in r.include)if(Object.prototype.hasOwnProperty.call(r.include,n)){let i=r.include[n];if(typeof i=="object"){const s=H(e.fields.find(n));s&&(i=hn(i,s.toRepo.metadata))}t[n]=i}r={...r,include:t}}return r.where&&(r={...r,where:D.entityFilterToJson(e,r.where)}),r.load&&(r={...r,load:r.load(e.fields).map(t=>t.key)}),r}class os{constructor(e,t,n){c(this,"url");c(this,"http");c(this,"entity");this.url=e,this.http=t,this.entity=n}translateFromJson(e){let t={};for(const n of this.entity.fields)t[n.key]=n.valueConverter.fromJson(e[n.key]);return t}translateToJson(e){let t={};for(const n of this.entity.fields)t[n.key]=n.valueConverter.toJson(e[n.key]);return t}async count(e){const{run:t}=this.buildFindRequest({where:e});return t("count").then(n=>+n.count)}find(e){let{run:t}=this.buildFindRequest(e);return t().then(n=>n.map(i=>this.translateFromJson(i)))}buildFindRequest(e){let t=new Jn(this.url()),n;if(e){if(e.where&&(n=e.where.toJson(),ls(n,t)&&(n=void 0)),e.orderBy&&e.orderBy.Segments){let s="",o="",a=!1;e.orderBy.Segments.forEach(l=>{s.length>0&&(s+=",",o+=","),s+=l.field.key,o+=l.isDescending?"desc":"asc",l.isDescending&&(a=!0)}),s&&t.add("_sort",s),a&&t.add("_order",o)}e.limit&&t.add("_limit",e.limit),e.page&&t.add("_page",e.page)}const i=s=>{let o=new Jn(t.url);return!s&&n&&(s="get"),s&&o.add("__action",s),n?this.http().post(o.url,n):this.http().get(o.url)};return{createKey:()=>JSON.stringify({url:t,filterObject:n}),run:i,subscribe:async s=>({result:await i(us+s),unsubscribe:async()=>E.actionInfo.runActionWithoutBlockingUI(()=>this.http().post(this.url()+"?__action=endLiveQuery",{id:s}))})}}update(e,t){let n={},i=Object.keys(t);for(const s of this.entity.fields)i.includes(s.key)&&(n[s.key]=s.valueConverter.toJson(t[s.key]));return this.http().put(this.url()+"/"+encodeURIComponent(e),n).then(s=>this.translateFromJson(s))}delete(e){return this.http().delete(this.url()+"/"+encodeURIComponent(e))}insert(e){return this.http().post(this.url(),this.translateToJson(e)).then(t=>this.translateFromJson(t))}}class qn{constructor(e){c(this,"fetch");this.fetch=e}async get(e){return await gt(async()=>this.myFetch(e).then(t=>t))}put(e,t){return this.myFetch(e,{method:"put",body:JSON.stringify(t)})}delete(e){return this.myFetch(e,{method:"delete"})}async post(e,t){return await gt(()=>this.myFetch(e,{method:"post",body:JSON.stringify(t)}))}myFetch(e,t){const n={};if(t!=null&&t.body&&(n["Content-type"]="application/json"),typeof window<"u"&&typeof window.document<"u"&&typeof(window.document.cookie!=="undefined"))for(const i of window.document.cookie.split(";"))i.trim().startsWith("XSRF-TOKEN=")&&(n["X-XSRF-TOKEN"]=i.split("=")[1]);return(this.fetch||fetch)(e,{credentials:"include",method:t==null?void 0:t.method,body:t==null?void 0:t.body,headers:n}).then(i=>as(i)).catch(async i=>{throw await i})}}function as(r){if(r.status!=204){if(r.status>=200&&r.status<300)return r.json();throw r.json().then(e=>({...e,message:e.message||r.statusText,url:r.url,status:r.status})).catch(()=>{throw{message:r.statusText,url:r.url,status:r.status}})}}function ls(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];if(Array.isArray(n)&&(n.length>0&&typeof n[0]=="object"||n.length>10))return!1}for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];Array.isArray(n)?t.endsWith(".in")?e.add(t,JSON.stringify(n)):n.forEach(i=>e.add(t,i)):t.startsWith(Ie)?e.add(t,JSON.stringify(n)):e.add(t,n)}return!0}const us="liveQuery-";var ct,fs=new Uint8Array(16);function cs(){if(!ct&&(ct=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ct))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ct(fs)}const ds=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function hs(r){return typeof r=="string"&&ds.test(r)}var G=[];for(var Bt=0;Bt<256;++Bt)G.push((Bt+256).toString(16).substr(1));function ps(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(G[r[e+0]]+G[r[e+1]]+G[r[e+2]]+G[r[e+3]]+"-"+G[r[e+4]]+G[r[e+5]]+"-"+G[r[e+6]]+G[r[e+7]]+"-"+G[r[e+8]]+G[r[e+9]]+"-"+G[r[e+10]]+G[r[e+11]]+G[r[e+12]]+G[r[e+13]]+G[r[e+14]]+G[r[e+15]]).toLowerCase();if(!hs(t))throw TypeError("Stringified UUID is invalid");return t}function zt(r,e,t){r=r||{};var n=r.random||(r.rng||cs)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return ps(n)}class ue{constructor(...e){c(this,"Segments");this.Segments=e}toEntityOrderBy(){let e={};for(const t of this.Segments)t.isDescending?e[t.field.key]="desc":e[t.field.key]="asc";return e}reverse(){let e=new ue;for(const t of this.Segments)e.Segments.push({field:t.field,isDescending:!t.isDescending});return e}compare(e,t,n){n||(n=s=>s.key);let i=0;for(let s=0;s<this.Segments.length;s++){let o=this.Segments[s],a=xn(e[n(o.field)]),l=xn(t[n(o.field)]);if(a>l?i=1:a<l&&(i=-1),i!=0)return o.isDescending&&(i*=-1),i}return i}static translateOrderByToSort(e,t){if(!t)return;let n=new ue;if(t){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];let o=e.fields.find(i);const a=l=>{switch(s){case"desc":n.Segments.push({field:l,isDescending:!0});break;case"asc":n.Segments.push({field:l})}};if(o){const l=H(o);if((l==null?void 0:l.type)==="toOne"){const u=l.options;if(typeof u.field=="string")a(e.fields.find(u.field));else if(u.fields){for(const f in u.fields)if(Object.prototype.hasOwnProperty.call(u.fields,f)){const d=u.fields[f];a(e.fields.find(d.toString()))}}}else a(o)}}}return n}static createUniqueSort(e,t){if((!t||Object.keys(t).length===0)&&e.options.defaultOrderBy&&(t=ue.translateOrderByToSort(e,e.options.defaultOrderBy)),t||(t=new ue({field:e.idMetadata.field})),e.idMetadata.field instanceof ke)for(const n of e.idMetadata.field.fields)t.Segments.find(i=>i.field==n)||t.Segments.push({field:n});else t.Segments.find(n=>n.field==e.idMetadata.field)||t.Segments.push({field:e.idMetadata.field});return t}static createUniqueEntityOrderBy(e,t){if((!t||Object.keys(t).length===0)&&(t=e.options.defaultOrderBy),t?t={...t}:t={[e.idMetadata.field.key]:"asc"},e.idMetadata.field instanceof ke)for(const n of e.idMetadata.field.fields)t[n.key]||(t[n.key]="asc");else t[e.idMetadata.field.key]||(t[e.idMetadata.field.key]="asc");return t}}function xn(r){return r==null||r==null?r:r.id!==void 0?r.id:r}const Nt="stream";class ys{constructor(e,t,n){c(this,"repo");c(this,"query");c(this,"queryChannel");c(this,"subscribeCode");c(this,"unsubscribe",()=>{});c(this,"defaultQueryState",[]);c(this,"listeners",[]);c(this,"id",zt());this.repo=e,this.query=t,this.queryChannel=`users:${n}:queries:${this.id}`,this.id=this.queryChannel}sendDefaultState(e){e(this.createReducerType(()=>[...this.defaultQueryState],this.allItemsMessage(this.defaultQueryState)))}async setAllItems(e){const t=await Be(this.repo).fromJsonArray(e,this.query.options);this.forListeners(n=>{n(()=>t)},this.allItemsMessage(t))}allItemsMessage(e){return[{type:"all",data:e}]}forListeners(e,t){e(n=>{if(this.defaultQueryState=n(this.defaultQueryState),t.find(i=>i.type==="add"||i.type==="replace")&&this.query.options.orderBy){const i=ue.translateOrderByToSort(this.repo.metadata,this.query.options.orderBy);this.defaultQueryState.sort((s,o)=>i.compare(s,o))}});for(const n of this.listeners)e(i=>{n.next(this.createReducerType(i,t))})}createReducerType(e,t){return{applyChanges:e,changes:t,items:this.defaultQueryState}}async handle(e){{let t=e.filter(({type:i})=>i=="add"||i=="replace"),n=await Be(this.repo).fromJsonArray(t.map(i=>i.data.item),this.query.options);for(let i=0;i<t.length;i++){const s=t[i];s.data.item=n[i]}}this.forListeners(t=>{t(n=>{n||(n=[]);for(const i of e)switch(i.type){case"all":this.setAllItems(i.data);break;case"replace":{n=n.map(s=>this.repo.metadata.idMetadata.getId(s)===i.data.oldId?i.data.item:s);break}case"add":n=n.filter(s=>this.repo.metadata.idMetadata.getId(s)!==this.repo.metadata.idMetadata.getId(i.data.item)),n.push(i.data.item);break;case"remove":n=n.filter(s=>this.repo.metadata.idMetadata.getId(s)!==i.data.id);break}return n})},e)}}const ms="_liveQueryKeepAlive";class gs{constructor(e,t){c(this,"apiProvider");c(this,"getUserId");c(this,"queries",new Map);c(this,"channels",new Map);c(this,"client");c(this,"interval");this.apiProvider=e,this.getUserId=t}wrapMessageHandling(e){var t=this.apiProvider().wrapMessageHandling;t?t(e):e()}hasQueriesForTesting(){return this.queries.size>0}runPromise(e){return e}close(){this.queries.clear(),this.channels.clear(),this.closeIfNoListeners()}async subscribeChannel(e,t){let n=()=>{};const i=await this.openIfNoOpened();try{let s=this.channels.get(e);if(!s){this.channels.set(e,s=new ws);try{s.unsubscribe=await i.subscribe(e,o=>this.wrapMessageHandling(()=>s.handle(o)),o=>{t.error(o)})}catch(o){throw t.error(o),o}}s.listeners.push(t),n=()=>{s.listeners.splice(s.listeners.indexOf(t),1),s.listeners.length==0&&(this.channels.delete(e),s.unsubscribe()),this.closeIfNoListeners()}}catch(s){throw t.error(s),s}return()=>{n(),n=()=>{}}}closeIfNoListeners(){this.client&&this.queries.size===0&&this.channels.size===0&&(this.runPromise(this.client.then(e=>e.close())),this.client=void 0,clearInterval(this.interval),this.interval=void 0)}subscribe(e,t,n){let i=!0,s=()=>{i=!1};return this.runPromise(Be(e).buildEntityDataProviderFindOptions(t).then(o=>{if(!i)return;const{createKey:a,subscribe:l}=new hr(this.apiProvider).getEntityDataProvider(e.metadata).buildFindRequest(o),u=a();let f=this.queries.get(u);f?f.sendDefaultState(n.next):(this.queries.set(u,f=new ys(e,{entityKey:e.metadata.key,options:t},this.getUserId())),f.subscribeCode=()=>{f.unsubscribe&&(f.unsubscribe(),f.unsubscribe=()=>{}),this.runPromise(this.subscribeChannel(f.queryChannel,{next:d=>this.runPromise(f.handle(d)),complete:()=>{},error:d=>{f.listeners.forEach(p=>p.error(d))}}).then(d=>{if(f.listeners.length==0){d();return}this.runPromise(l(f.queryChannel).then(p=>{if(f.listeners.length===0){p.unsubscribe(),d();return}this.runPromise(f.setAllItems(p.result)),f.unsubscribe=()=>{f.unsubscribe=()=>{},d(),this.runPromise(p.unsubscribe())}}).catch(p=>{f.listeners.forEach(g=>g.error(p)),d(),this.queries.delete(u)}))})).catch(d=>{f.listeners.forEach(p=>p.error(d))})},f.subscribeCode()),f.listeners.push(n),s=()=>{f.listeners.splice(f.listeners.indexOf(n),1),n.complete(),f.listeners.length==0&&(this.queries.delete(u),f.unsubscribe()),this.closeIfNoListeners()}}).catch(o=>{n.error(o)})),()=>{s()}}openIfNoOpened(){return this.client?this.client:(this.interval=setInterval(async()=>{const e=[];for(const t of this.queries.values())e.push(t.queryChannel);if(e.length>0){let t=this.apiProvider();const n=await this.runPromise(await E.actionInfo.runActionWithoutBlockingUI(()=>Ot(t.httpClient).post(t.url+"/"+ms,e)));for(const i of n)for(const s of this.queries.values())s.queryChannel===i&&s.subscribeCode()}},3e4),this.runPromise(this.client=this.apiProvider().subscriptionClient.openConnection(()=>{for(const e of this.queries.values())e.subscribeCode()})))}}class ws{constructor(){c(this,"id");c(this,"unsubscribe",()=>{});c(this,"listeners",[])}async handle(e){for(const t of this.listeners)t.next(e)}}class pn{openConnection(e){let t;const n=new Map,i=Ot(Ke.apiClient.httpClient);let s=!1,o;const a={close(){o.close()},async subscribe(f,d){let p=n.get(f);return p||(n.set(f,p=[]),await u(f)),p.push(d),()=>{p.splice(p.indexOf(d,1)),p.length==0&&(E.actionInfo.runActionWithoutBlockingUI(()=>i.post(Ke.apiClient.url+"/"+Nt+"/unsubscribe",{channel:f,clientId:t})),n.delete(f))}}},l=()=>new Promise(f=>{d();function d(){o&&o.close(),o=pn.createEventSource(Ke.apiClient.url+"/"+Nt),o.onmessage=p=>{let g=JSON.parse(p.data);const k=n.get(g.channel);k&&k.forEach(_=>_(g.data))},o.onerror=p=>{console.error("Live Query Event Source Error",p),o.close(),setTimeout(()=>{d()},500)},o.addEventListener("connectionId",async p=>{if(t=p.data,s){for(const g of n.keys())await u(g);e()}else s=!0,f(a)})}});return l();async function u(f){await E.actionInfo.runActionWithoutBlockingUI(()=>i.post(Ke.apiClient.url+"/"+Nt+"/subscribe",{channel:f,clientId:t}))===bs&&await l()}}static createEventSource(e){return new EventSource(e,{withCredentials:!0})}}const bs="client connection not found",vs=Symbol.for("serverActionField");class ks{constructor(e){c(this,"remultObjectStorage");this.remultObjectStorage=e}static enable(){E.remultFactory=()=>{const e=E.asyncContext.getRemult();if(e)return e;throw new Error("remult object was requested outside of a valid context, try running it within initApi or a remult request cycle")}}static disable(){cr()}run(e,t){this.remultObjectStorage?this.remultObjectStorage.run(e,()=>t(e)):t(e)}getRemult(){if(!this.remultObjectStorage)throw new Error("can't use static remult in this environment, `async_hooks` were not initialized");return this.remultObjectStorage.getStore()}}E.asyncContext||(E.asyncContext=new ks(void 0));function _s(){return E.actionInfo.runningOnServer||!Ke.dataProvider.isProxy}class Ne{constructor(e){c(this,"user");c(this,"dataProvider",new hr(()=>this.apiClient));c(this,"repCache",new Map);c(this,"liveQueryStorage");c(this,"subscriptionServer");c(this,"liveQueryPublisher",{itemChanged:async()=>{}});c(this,"liveQuerySubscriber",new gs(()=>this.apiClient,()=>{var e;return(e=this.user)==null?void 0:e.id}));c(this,"context",{});c(this,"apiClient",{url:"/api",subscriptionClient:new pn});if(e&&e.getEntityDataProvider){this.dataProvider=e;return}if(dr(e))this.apiClient.httpClient=e;else if(typeof e=="function")this.apiClient.httpClient=e;else if(e){const t=e;t.httpClient&&(this.apiClient.httpClient=t.httpClient),t.url&&(this.apiClient.url=t.url),t.subscriptionClient&&(this.apiClient.subscriptionClient=t.subscriptionClient),t.wrapMessageHandling&&(this.apiClient.wrapMessageHandling=t.wrapMessageHandling)}}repo(e,t){t===void 0&&(t=this.dataProvider);let n=this.repCache.get(t);n||this.repCache.set(t,n=new Map);let i=n.get(e);return i||(n.set(e,i=new yn(e,this,t,Ss(e,this))),Qi(i,this,t)),i}authenticated(){var e;return((e=this.user)==null?void 0:e.id)!==void 0}isAllowed(e){var t,n;if(e!=null){if(e instanceof Array){for(const i of e)if(this.isAllowed(i)===!0)return!0;return!1}return typeof e=="function"?e(this):typeof e=="boolean"?e:!!(typeof e=="string"&&(n=(t=this.user)==null?void 0:t.roles)!=null&&n.includes(e.toString()))}}isAllowedForInstance(e,t){if(Array.isArray(t)){for(const n of t)if(this.isAllowedForInstance(e,n))return!0}else return typeof t=="function"?t(e,this):this.isAllowed(t)}call(e,t,...n){const i=e[vs];if(!i.doWork)throw Error("The method received is not a valid backend method");return i.doWork(n,t,this.apiClient.url,Ot(this.apiClient.httpClient))}clearAllCache(){this.repCache.clear()}}c(Ne,"onFind",(e,t)=>{}),c(Ne,"entityRefInit");E.defaultRemultFactory=()=>new Ne;const Os={defaultPageSize:200};function pr(r,e){return e&&Object.assign(r,e),r}class he{}c(he,"number","number"),c(he,"date","date"),c(he,"checkbox","checkbox"),c(he,"password","password"),c(he,"email","email"),c(he,"tel","tel"),c(he,"time","time");const A=class A{};c(A,"Date",{toJson:e=>{if(e===null)return null;if(!e)return"";if(typeof e=="string"&&(e=new Date(e)),e instanceof Date)return e.toISOString();throw new Error("Expected date but got "+e)},fromJson:e=>{if(e===null)return null;if(e!=null&&e!=""&&!e.startsWith("0000-00-00"))return new Date(Date.parse(e))},toDb:e=>e,fromDb:e=>{if(typeof e=="number"&&(e=new Date(e)),typeof e=="string"&&(e=new Date(e)),e&&!(e instanceof Date))throw"expected date but got "+e;return e},fromInput:e=>A.Date.fromJson(e),toInput:e=>A.Date.toJson(e),displayValue:e=>e?e.toLocaleString():""}),c(A,"DateOnly",{fromInput:e=>A.DateOnly.fromJson(e),toInput:e=>A.DateOnly.toJson(e),toJson:e=>{var t=e;return(typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!t||t==null?null:t.getHours()==0?new Date(t.valueOf()-t.getTimezoneOffset()*6e4).toISOString().substring(0,10):t.toISOString().substring(0,10)},fromJson:e=>{if(!e||e==""||e=="0000-00-00")return null;let t=new Date(Date.parse(e));return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},inputType:he.date,toDb:e=>e?A.DateOnly.fromJson(A.DateOnly.toJson(e)):null,fromDb:e=>A.Date.fromDb(e),fieldTypeInDb:"date",displayValue:e=>e?e.toLocaleDateString(void 0):""}),c(A,"DateOnlyString",{...A.DateOnly,toDb:e=>{let t=A.DateOnly.toJson(e);if(t)return t.replace(/-/g,"")},fromDb:e=>{if(e===null)return null;if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))}}),c(A,"Boolean",{toDb:e=>e,inputType:he.checkbox,fromDb:e=>A.Boolean.fromJson(e),fromJson:e=>typeof e=="boolean"?e:e===1?!0:e!=null?e.toString().trim().toLowerCase()=="true":e,toJson:e=>e,fromInput:e=>A.Boolean.fromJson(e),toInput:e=>A.Boolean.toJson(e)}),c(A,"Number",{fromDb:e=>{if(e===null)return null;if(e!==void 0)return+e},toDb:e=>e,fromJson:e=>A.Number.fromDb(e),toJson:e=>A.Number.toDb(e),fromInput:(e,t)=>{let n=+e;if(e)return n},toInput:(e,t)=>e==null?void 0:e.toString(),inputType:he.number}),c(A,"String",{fromDb:Fe,toDb:Fe,fromJson:Fe,toJson:Fe,fromInput:Fe,toInput:Fe}),c(A,"Integer",{...A.Number,toJson:e=>{let t=A.Number.toDb(e);return t&&+(+t).toFixed(0)},toDb:e=>A.Integer.toJson(e),fieldTypeInDb:"integer"}),c(A,"Default",{fromJson:e=>e,toJson:e=>e,fromDb:e=>A.JsonString.fromDb(e),toDb:e=>A.JsonString.toDb(e),fromInput:e=>A.Default.fromJson(e),toInput:e=>A.Default.toJson(e),displayValue:e=>e+"",fieldTypeInDb:"",inputType:"text"}),c(A,"JsonString",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e==null?null:e?JSON.parse(A.JsonString.fromJson(e)):void 0,toDb:e=>e!==void 0?e===null?null:JSON.stringify(A.JsonString.toJson(e)):void 0,fromInput:e=>A.JsonString.fromJson(e),toInput:e=>A.JsonString.toJson(e)}),c(A,"JsonValue",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e,toDb:e=>e,fromInput:e=>A.JsonString.fromJson(e),toInput:e=>A.JsonString.toJson(e),fieldTypeInDb:"json"});let se=A;function Fe(r){return r==null?r:typeof r!="string"?r.toString():r}function Un(r,e,t){let n=D.fromEntityFilter(r,e);const i=()=>{};n&&n.__applyToConsumer({custom:i,databaseCustom:i,containsCaseInsensitive:i,notContainsCaseInsensitive:i,isDifferentFrom:i,isEqualTo:(s,o)=>{t[s.key]=o},isGreaterOrEqualTo:i,isGreaterThan:i,isIn:i,isLessOrEqualTo:i,isLessThan:i,isNotNull:i,isNull:i,or:i})}class Hn{constructor(){c(this,"entityLoaders",new Map);c(this,"promises",[])}load(e,t){let n=this.entityLoaders.get(e.entityType);n||this.entityLoaders.set(e.entityType,n=new Is(e));const i=n.find(t);return this.promises.push(i),i}async resolveAll(){for(const t of this.entityLoaders.values())for(const n of t.queries.values())n.resolve();if(this.promises.length===0)return;const e=this.promises;this.promises=[],await Promise.all(e),await this.resolveAll()}}class Is{constructor(e){c(this,"rel");c(this,"queries",new Map);this.rel=e}find(e){const{where:t,...n}=hn(e,this.rel.metadata),i=JSON.stringify(n);let s=this.queries.get(i);return s||this.queries.set(i,s=new Es(this.rel)),s.find(e,t)}}class Es{constructor(e){c(this,"rel");c(this,"pendingInStatements",new Map);c(this,"whereVariations",new Map);this.rel=e}find(e,t){const n=JSON.stringify(t);let i=this.whereVariations.get(n);if(!i){const s=Object.keys(t);if(s.length===1&&typeof t[s[0]]!="object"&&!e.limit){let o=this.pendingInStatements.get(s[0]);o||this.pendingInStatements.set(s[0],o=new Cs(this.rel,s[0],e)),this.whereVariations.set(n,i={result:o.find(t)})}else this.whereVariations.set(n,i={result:this.rel.find(e)})}return i.result}resolve(){const e=[...this.pendingInStatements.values()];this.pendingInStatements.clear();for(const t of e)t.resolve()}}class Cs{constructor(e,t,n){c(this,"rel");c(this,"key");c(this,"options");c(this,"values",new Map);this.rel=e,this.key=t,this.options=n}async resolve(){const e=[...this.values.values()];if(e.length==1){this.rel.find(this.options).then(e[0].resolve,e[0].reject);return}var t={...this.options};t.where={[this.key]:e.map(i=>i.value)},t.limit=1e3,t.page=1;let n=[];try{for(;;){const i=await this.rel.find(t);if(n.push(...i),i.length<t.limit)break;t.page++}for(const i of this.values.values())i.resolve(n.filter(s=>{const a=W(s).fields.find(this.key),l=H(a.metadata),u=(l==null?void 0:l.type)==="reference"?a.getId():s[this.key];return i.value==u}))}catch(i){for(const s of this.values.values())s.reject(i)}}find(e){const t=e[this.key];let n=this.values.get(t);if(!n){let i,s,o=new Promise((a,l)=>{i=a,s=l});this.values.set(t,n={value:t,resolve:i,reject:s,result:o})}return n.result}}class yn{constructor(e,t,n,i,s){c(this,"entity");c(this,"remult");c(this,"dataProvider");c(this,"_info");c(this,"defaultFindOptions");c(this,"__edp");c(this,"idCache",new Map);c(this,"listeners");c(this,"cache",new Map);this.entity=e,this.remult=t,this.dataProvider=n,this._info=i,this.defaultFindOptions=s}[Ze](){return this}async createAfterFilter(e,t){let n=new Map;for(const o of ue.translateOrderByToSort(this.metadata,e).Segments){let a=t[o.field.key];n.set(o.field.key,a)}let i={$or:[]},s=[];for(const o of ue.translateOrderByToSort(this.metadata,e).Segments){let a={};for(const l of s)a[l.key]=n.get(l.key);s.push(o.field),o.isDescending?a[o.field.key]={$lt:n.get(o.field.key)}:a[o.field.key]={$gt:n.get(o.field.key)},i.$or.push(a)}return i}relations(e){return new Proxy({},{get:(t,n)=>{const i=this.fields.find(n),s=H(i);if(!s)throw Error(n+" is not a relation");const{toRepo:o,returnNull:a,returnUndefined:l}=this.getFocusedRelationRepo(i,e);return s.type==="toMany"?o:{findOne:u=>a?Promise.resolve(null):l?Promise.resolve(void 0):o.findFirst({},u)}}})}getFocusedRelationRepo(e,t){const n=H(e);let i=n.toRepo,{findOptions:s,returnNull:o,returnUndefined:a}=this.findOptionsBasedOnRelation(n,e,void 0,t,i);return{toRepo:new yn(i.entity,i.remult,i.dataProvider,i._info,s),returnNull:o,returnUndefined:a}}get edp(){return this.__edp?this.__edp:this.__edp=this.dataProvider.getEntityDataProvider(this.metadata)}getCachedById(e,t){e=e+"",this.getCachedByIdAsync(e,t);let n=this.idCache.get(e);if(!(n instanceof Promise))return n}async getCachedByIdAsync(e,t){e=e+"";let n=this.idCache.get(e);if(n instanceof Promise)return await n;if(this.idCache.has(e))return n;if(t)return;this.idCache.set(e,void 0);let i=this.findId(e).then(s=>(s===void 0?n=null:n=s,this.idCache.set(e,n),n));return this.idCache.set(e,i),await i}addToCache(e){e&&this.idCache.set(this.getEntityRef(e).getId()+"",e)}get metadata(){return this._info}addEventListener(e){return this.listeners||(this.listeners=[]),this.listeners.push(e),()=>{this.listeners.splice(this.listeners.indexOf(e),1)}}query(e){return new Bs(e,this)}getEntityRef(e){let t=e[De];return t||(this.fixTypes(e),t=new dt(this._info,e,this,this.edp,this.remult,!0),Object.defineProperty(e,De,{get:()=>t}),t.saveOriginalData()),t}async delete(e){const t=W(e,!1);if(t)return t.delete();if(typeof e=="string"||typeof e=="number"){if(this.dataProvider.isProxy)return this.edp.delete(e);{let i=await this.findId(e);if(i)return await W(i).delete()}}let n=this.getRefForExistingRow(e,void 0);return this.dataProvider.isProxy||await n.reload(),n.delete()}async insert(e){if(Array.isArray(e)){let t=[];for(const n of e)t.push(await this.insert(n));return t}else{let t=W(e,!1);if(t){if(!t.isNew())throw"Item is not new";return await t.save()}else return await this.getEntityRef(this.create(e)).save()}}get fields(){return this.metadata.fields}async validate(e,...t){{let n=W(e,!1);if(n||(n=this.getEntityRef({...e})),!t||t.length===0)return await n.validate();{n.__clearErrorsAndReportChanged();let i=!1;for(const s of t)await n.fields.find(s).validate()||(i=!0);return i?n.buildErrorInfoObject():void 0}}}async update(e,t){{let i=W(t,!1);if(i)return await i.save()}{let i=W(e,!1);if(i)return pr(e,t),i.save()}let n;if(typeof e=="object"?(n=this.getRefForExistingRow(e,this.metadata.idMetadata.getId(e)),Object.assign(n.instance,t)):n=this.getRefForExistingRow(t,e),this.dataProvider.isProxy)return await n.save(Object.keys(t));{const i=await n.reload();if(!i)throw new Error("Not Found");for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let o=n.fields[s];if(t[s]===void 0&&H(o.metadata))continue;o&&(i[s]=t[s])}return await this.fixTypes(i),await n.save()}}getRefForExistingRow(e,t){let n=W(e,!1);if(!n){const i=new this.entity(this.remult);for(const o of this.fieldsOf(e))i[o.key]=e[o.key];this.fixTypes(i);let s=new dt(this._info,i,this,this.edp,this.remult,!1);typeof t=="object"&&(t=this.metadata.idMetadata.getId(t)),t?(s.id=t,s.originalId=t):s.id=s.getId(),n=s,Object.defineProperty(i,De,{get:()=>s})}return n}async save(e){if(Array.isArray(e))return Promise.all(e.map(t=>this.save(t)));{let t=W(e,!1);if(t)return await t.save();if(e instanceof gr)return await this.getEntityRef(e).save();{let n=this.metadata.idMetadata.getId(e);return n===void 0?this.insert(e):this.update(n,e)}}}liveQuery(e){return e||(e={}),{subscribe:t=>{let n=t;return typeof t=="function"&&(n={next:t,complete:()=>{},error:()=>{}}),n.error??(n.error=()=>{}),n.complete??(n.complete=()=>{}),this.remult.liveQuerySubscriber.subscribe(this,e,n)}}}async rawFind(e,t=!1,n){e||(e={}),this.defaultFindOptions&&(e={...this.defaultFindOptions,...e});let i=await this.buildEntityDataProviderFindOptions(e);t&&(delete i.orderBy,delete i.limit),Ne.onFind(this._info,e);const s=await this.edp.find(i);return await this.loadManyToOneForManyRows(s,e,n)}async find(e,t=!1){const n=new Hn,i=await this.rawFind(e,t,n);return await n.resolveAll(),i}async buildEntityDataProviderFindOptions(e){let t={};return t={},(!e.orderBy||Object.keys(e.orderBy).length===0)&&(e.orderBy=this._info.entityInfo.defaultOrderBy),t.where=await this.translateWhereToFilter(e.where),e.orderBy!==void 0&&(t.orderBy=ue.translateOrderByToSort(this.metadata,e.orderBy)),e.limit!==void 0&&(t.limit=e.limit),e.page!==void 0&&(t.page=e.page),t}async fromJsonArray(e,t){const n=new Hn,i=await this.loadManyToOneForManyRows(e.map(s=>{let o={};for(const a of this.metadata.fields.toArray())o[a.key]=a.valueConverter.fromJson(s[a.key]);return o}),t,n);return await n.resolveAll(),i}async loadManyToOneForManyRows(e,t,n){var a;let i;t!=null&&t.load&&(i=t.load(this.metadata.fields));for(const l of this.metadata.fields)if(me(l.valueType,!1)&&!H(l)){let d=!l.options.lazy;if(i!==void 0&&(d=i.includes(l)),d){let p=this.remult.repo(l.valueType),g=[];for(const k of e){let _=k[l.key];_!=null&&!g.includes(_)&&!p.idCache.has(_+"")&&g.push(_)}g.length>0&&await s(p,g)}}async function s(l,u){let f=await l.find({where:l.metadata.idMetadata.getIdFilter(...u)},!0);for(const d of f)l.addToCache(d)}let o=await Promise.all(e.map(async l=>await this.mapRawDataToResult(l,i)));for(const l of this.metadata.fields){let u=H(l),f=l.options.defaultIncluded;if(((a=t==null?void 0:t.include)==null?void 0:a[l.key])!==void 0&&(f=t.include[l.key]),u&&f){const d=u.toRepo;for(const p of o){let{findOptions:g,returnNull:k}=this.findOptionsBasedOnRelation(u,l,f,p,d);if(k)p[l.key]=null;else{const _=u.toEntity,C=d;n.load({entityType:_,find:M=>C.rawFind(M,!1,n),metadata:C.metadata},g).then(M=>{M.length==0&&u.type=="toOne"||(p[l.key]=u.type!=="toMany"?M.length==0?null:M[0]:M)})}}}}return o}findOptionsBasedOnRelation(e,t,n,i,s){let o=!1,a=!1,l=[],u={},f=[];typeof e.options.findOptions=="function"?f.push(e.options.findOptions(i)):typeof e.options.findOptions=="object"&&f.push(e.options.findOptions),typeof n=="object"&&f.push(n);for(const g of f){g.where&&l.push(g.where);for(const k of["limit","include","orderBy"])g[k]&&(u[k]=g[k])}const d=e.getFields(),p=g=>{let k=e.type==="reference"?W(i).fields.find(t.key).getId():i[g];return(e.type==="toOne"||e.type==="reference")&&(k===null?o=!0:k===void 0?a=!0:e.type==="reference"&&typeof k=="object"&&(k=s.metadata.idMetadata.getId(k))),k};d.compoundIdField&&(e.type==="toMany"?l.push({[d.compoundIdField]:this.metadata.idMetadata.getId(i)}):l.push(s.metadata.idMetadata.getIdFilter(p(d.compoundIdField))));for(const g in d.fields)Object.prototype.hasOwnProperty.call(d.fields,g)&&l.push({[g]:p(d.fields[g])});return u.where={$and:l},(e.type==="toOne"||e.type==="reference")&&u.orderBy&&(u.limit=1),{findOptions:u,returnNull:o,returnUndefined:a}}async mapRawDataToResult(e,t){if(!e)return;let n=new this.entity(this.remult),i=new dt(this._info,n,this,this.edp,this.remult,!1);return Object.defineProperty(n,De,{get:()=>i}),await i.loadDataFrom(e,t),i.saveOriginalData(),n}toJson(e){return e==null?e:Array.isArray(e)?e.map(t=>this.toJson(t)):typeof e.then=="function"?e.then(t=>this.toJson(t)):this.getEntityRef(e).toApiJson(!0)}fromJson(e,t){if(e==null)return e;if(Array.isArray(e))return e.map(i=>this.fromJson(i,t));let n=new this.entity(this.remult);for(const i of this.fieldsOf(e))if(me(i.valueType,!1)){let o=e[i.key];typeof o=="string"||typeof o=="number"?n[i.key]=o:n[i.key]=this.remult.repo(i.valueType).fromJson(o)}else e[i.key]!==void 0&&(n[i.key]=i.valueConverter.fromJson(e[i.key]));if(this.fixTypes(n),t)return this.create(n);{let i=new dt(this._info,n,this,this.edp,this.remult,!1);return Object.defineProperty(n,De,{get:()=>i}),i.saveOriginalData(),n}}async count(e){return this.edp.count(await this.translateWhereToFilter(e))}async findOne(e,t=!1){let n,i;if(e||(e={}),e.useCache){let s=hn(e,this.metadata),o=JSON.stringify(s);if(i=this.cache.get(o),i!==void 0)if(i.value&&this.getEntityRef(i.value).wasDeleted())i=void 0,this.cache.delete(o);else return this.cache.get(o).promise;else i={value:void 0,promise:void 0},this.cache.set(o,i)}return n=this.find({...e,limit:1},t).then(async s=>{let o;return s.length>0&&(o=s[0]),!o&&e.createIfNotFound&&(o=this.create(),e.where&&await Un(this.metadata,e.where,o)),o}),i&&(i.promise=n=n.then(s=>(i.value=s,s))),n}async findFirst(e,t,n=!1){if(t||(t={}),e)if(t.where){let i=t.where;t.where={$and:[i,e]}}else t.where=e;return this.findOne(t,n)}fieldsOf(e){let t=Object.keys(e);return this.metadata.fields.toArray().filter(n=>t.includes(n.key))}create(e){var n;let t=new this.entity(this.remult);if(e){for(const i of this.fieldsOf(e))t[i.key]=e[i.key];this.fixTypes(t)}return(n=this.defaultFindOptions)!=null&&n.where&&(Un(this.metadata,this.defaultFindOptions.where,t),this.fixTypes(t)),this.getEntityRef(t),t}async fixTypes(e){for(const t of this.fieldsOf(e)){const n=e[t.key];if(n!=null)if(t.valueType===Date&&!(n instanceof Date))e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(n));else for(const[i,s]of[[String,"string"],[Number,"number"],[Boolean,"boolean"]])t.valueType===i&&typeof n!==s&&(e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(n)))}return e}findId(e,t){if(e==null)return null;if(typeof e!="string"&&typeof e!="number")throw new Error("id can be either number or string, but got: "+typeof e);return this.findFirst({},{...t,where:this.metadata.idMetadata.getIdFilter(e)},!0)}async translateWhereToFilter(e){var n,i;e||(e={}),(n=this.defaultFindOptions)!=null&&n.where&&(e={$and:[e,(i=this.defaultFindOptions)==null?void 0:i.where]}),this.metadata.options.backendPrefilter&&!this.dataProvider.isProxy&&(e={$and:[e,await D.resolve(this.metadata.options.backendPrefilter)]});let t=await D.fromEntityFilter(this.metadata,e);return t&&!this.dataProvider.isProxy&&(t=await D.translateCustomWhere(t,this.metadata,this.remult)),t}}function Ss(r,e){let t=E.columnsOfType.get(r);t||E.columnsOfType.set(r,t=[]);let n=me(r)(e),i=Wi(r),s=Object.getPrototypeOf(r);for(;s!=null;){let o=E.columnsOfType.get(s);o&&t.unshift(...o.filter(l=>!t.find(u=>u.key==l.key)));let a=me(s,!1);if(a){let l=a(e);n={...l,...n};let u=["saving","saved","deleting","deleted","validation"];for(const f of u)if(l[f]&&l[f]!==n[f]){let d=n[f];n[f]=async(p,g)=>{await d(p,g),await l[f](p,g)}}}s=Object.getPrototypeOf(s)}return new Rs(As(t,e),n,e,r,i)}class Ts{constructor(e,t,n,i){c(this,"fieldsMetadata");c(this,"instance");c(this,"remult");c(this,"isNewRow");c(this,"_error");c(this,"_subscribers");c(this,"_isLoading",!1);c(this,"lookups",new Map);c(this,"errors");c(this,"originalValues",{});var s;this.fieldsMetadata=e,this.instance=t,this.remult=n,this.isNewRow=i;{let o=n;o!=null&&o.iAmRemultProxy&&(n=E.remultFactory())}for(const o of e)if(me(o.valueType,!1)&&n){let l=new rs(n.repo(o.valueType),!!H(o),o.allowNull);this.lookups.set(o.key,l);let u=t[o.key],f;Object.defineProperty(t,o.key,{get:()=>(this._subscribers&&(this._subscribers.reportObserved(),f||(f=this.fields.find(o.key),f._subscribers||(f._subscribers=new ht)),f._subscribers.reportObserved()),l.item),set:d=>{var p;l.set(d),(p=this._subscribers)==null||p.reportChanged(),f||(f=this.fields.find(o.key),f._subscribers||(f._subscribers=new ht)),f._subscribers.reportChanged()},enumerable:!0}),l.set(u)}else if(((s=H(o))==null?void 0:s.type)==="toOne"){let l=t.hasOwnProperty(o.key),u=t[o.key];i&&!u&&(l=!1),Object.defineProperty(t,o.key,{get:()=>u,set:f=>{if(u=f,f===void 0)return;const d=o.options;if(d.field&&(this.instance[d.field]=H(o).toRepo.metadata.idMetadata.getId(f)),d.fields){for(const p in d.fields)if(Object.prototype.hasOwnProperty.call(d.fields,p)){const g=d.fields[p];this.instance[g]=f==null?null:f[p]}}},enumerable:!0}),l&&(t[o.key]=u)}}get error(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._error}set error(e){var t;this._error=e,(t=this._subscribers)==null||t.reportChanged()}subscribe(e){return this.initSubscribers(),this._subscribers.subscribe(e)}initSubscribers(){if(!this._subscribers){this._subscribers=new ht;for(const e of this.fieldsMetadata){let t=me(e.valueType,!1),n=this.fields.find(e.key);if(n._subscribers=new ht,!(t&&this.remult)){let i=this.instance[e.key];Object.defineProperty(this.instance,e.key,{get:()=>(this._subscribers.reportObserved(),n._subscribers.reportObserved(),i),set:s=>{i=s,this._subscribers.reportChanged(),n._subscribers.reportChanged()},enumerable:!0})}}}}get isLoading(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._isLoading}set isLoading(e){var t;this._isLoading=e,(t=this._subscribers)==null||t.reportChanged()}async waitLoad(){await Promise.all([...this.lookups.values()].map(e=>e.waitLoad()))}__assertValidity(){if(!this.hasErrors())throw this.buildErrorInfoObject()}buildErrorInfoObject(){let e={modelState:Object.assign({},this.errors),message:this.error};if(!e.message){for(const t of this.fieldsMetadata)if(this.errors[t.key]){e.message=this.fields[t.key].metadata.caption+": "+this.errors[t.key],this.error=e.message;break}}return e}catchSaveErrors(e){let t=e;if(t instanceof Promise)return t.then(i=>this.catchSaveErrors(i));t.error&&(t=t.error),t.message?this.error=t.message:t.Message?this.error=t.Message:this.error=t;let n=t.modelState;throw n||(n=t.ModelState),n&&(this.errors=n),e}__clearErrorsAndReportChanged(){this.errors=void 0,this.error=void 0,this._reportChangedToEntityAndFields()}_reportChangedToEntityAndFields(){if(this._subscribers){this._subscribers.reportChanged();for(const e of this.fields)e._subscribers.reportChanged()}}hasErrors(){var e;return(e=this._subscribers)==null||e.reportObserved(),!this.error&&this.errors==null}copyDataToObject(e=!1){let t={};for(const n of this.fieldsMetadata){let i=this.lookups.get(n.key),s;const o=H(n);i?s=i.id:s=this.instance[n.key],o&&e&&!n.allowNull&&s==null&&(o.toRepo.metadata.idMetadata.field.valueType===Number?s=0:s=""),(!o||o.type==="reference")&&(s!==void 0&&(s=n.valueConverter.toJson(s),s!=null&&(s=n.valueConverter.fromJson(JSON.parse(JSON.stringify(s))))),t[n.key]=s)}return t}saveOriginalData(){this.originalValues=this.copyDataToObject(),this.saveMoreOriginalData()}saveMoreOriginalData(){}async validate(){if(this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.hasErrors(),!this.hasErrors())return this.buildErrorInfoObject()}async __validateEntity(){this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.__assertValidity()}async __performColumnAndEntityValidations(){}toApiJson(e=!1,t=!1){let n={};for(const i of this.fieldsMetadata)if(t||!this.remult||i.includedInApi(this.instance)){let s,o=this.lookups.get(i.key),a=!1;o?e?(s=o.toJson(),a=!0,n[i.key]=s):s=o.id:H(i)&&!e?a=!0:(s=this.instance[i.key],this.remult||s&&me(s.constructor,!1)&&(s=W(s).getId())),a||(n[i.key]=i.valueConverter.toJson(s))}return n}async _updateEntityBasedOnApi(e,t=!1){let n=Object.keys(e);for(const i of this.fieldsMetadata)if(n.includes(i.key)&&i.includedInApi(this.instance)&&(!this.remult||t||i.apiUpdateAllowed(this.instance))){let s=this.lookups.get(i.key);s?s.id=e[i.key]:this.instance[i.key]=i.valueConverter.fromJson(e[i.key])}await Promise.all([...this.fields].map(i=>i.load()))}}class dt extends Ts{constructor(t,n,i,s,o,a){super(t.fieldsMetadata,n,o,a);c(this,"info");c(this,"repository");c(this,"edp");c(this,"_isNew");c(this,"metadata");c(this,"_wasDeleted",!1);c(this,"_columns");c(this,"_saving",!1);c(this,"id");c(this,"originalId");if(this.info=t,this.repository=i,this.edp=s,this._isNew=a,this.metadata=t,a)for(const l of t.fieldsMetadata)l.options.defaultValue&&n[l.key]===void 0&&(typeof l.options.defaultValue=="function"?n[l.key]=l.options.defaultValue(n):n[l.key]||(n[l.key]=l.options.defaultValue));this.info.options.entityRefInit&&this.info.options.entityRefInit(this,n),Ne.entityRefInit&&Ne.entityRefInit(this,n)}clone(){const t=this.toApiJson(!0,!0);return this.repository.fromJson(t,this.isNew())}get relations(){return this.repository.relations(this.instance)}get apiUpdateAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiUpdate)}get apiDeleteAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiDelete)}get apiInsertAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiInsert)}getId(){const t=n=>{let i=this.lookups.get(n.key);return i?i.id:this.instance[n.key]};return this.metadata.idMetadata.field instanceof ke?this.metadata.idMetadata.field.fields.map(t).join(","):t(this.metadata.idMetadata.field)}saveMoreOriginalData(){this.originalId=this.getId()}wasDeleted(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._wasDeleted}undoChanges(){this.loadDataFrom(this.originalValues),this.__clearErrorsAndReportChanged()}async reload(){return await this.edp.find({where:this.getIdFilter()}).then(async t=>{await this.loadDataFrom(t[0]),this.saveOriginalData()}),this._reportChangedToEntityAndFields(),this.instance}get fields(){if(!this._columns){let t=[],n={find:i=>n[typeof i=="string"?i:i.key],[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t};for(const i of this.info.fieldsMetadata)t.push(n[i.key]=new Vn(i.options,i,this.instance,this,this));this._columns=n}return this._columns}async save(t){var n;try{if(this._saving)throw new Error("cannot save while entity is already saving");if(this._saving=!0,this.wasDeleted())throw new Error("cannot save a deleted row");this.isLoading=!0,t===void 0&&await this.__validateEntity();let i=!1,s=this.buildLifeCycleEvent(()=>i=!0);if(!this.remult.dataProvider.isProxy){for(const f of this.fields)f.metadata.options.saving&&await f.metadata.options.saving(this.instance,f,s);this.info.entityInfo.saving&&await this.info.entityInfo.saving(this.instance,s)}this.__assertValidity();let o=this.copyDataToObject(this.isNew()),a=[];for(const f of this.metadata.fields)if(f.dbReadOnly||t!==void 0&&!t.includes(f.key)){o[f.key]=void 0,a.push(f.key);let d=this.fields.find(f);d.value=d.originalValue}let l,u=this.isNew();try{if((n=this._subscribers)==null||n.reportChanged(),this.isNew())l=await this.edp.insert(o);else{let f={},d=!1;for(const p in o)if(Object.prototype.hasOwnProperty.call(o,p)){const g=o[p];this.fields.find(p).valueChanged()&&!a.includes(p)&&(f[p]=g,d=!0)}if(!d)return this.instance;i?l=(await this.edp.find({where:this.getIdFilter()}))[0]:l=await this.edp.update(this.id,f)}if(await this.loadDataFrom(l),!this.remult.dataProvider.isProxy&&(this.info.entityInfo.saved&&await this.info.entityInfo.saved(this.instance,s),this.repository.listeners))for(const f of this.repository.listeners.filter(d=>d.saved))await f.saved(this.instance,u);return await this.repository.remult.liveQueryPublisher.itemChanged(this.repository.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!1}]),this.saveOriginalData(),this._isNew=!1,this.instance}catch(f){await this.catchSaveErrors(f)}}finally{this.isLoading=!1,this._reportChangedToEntityAndFields(),this._saving=!1}}buildLifeCycleEvent(t=()=>{}){const n=this;return{isNew:n.isNew(),fields:n.fields,id:n.getId(),originalId:n.getOriginalId(),metadata:n.repository.metadata,repository:n.repository,preventDefault:()=>t(),relations:n.repository.relations(n.instance)}}getIdFilter(){return D.fromEntityFilter(this.metadata,this.repository.metadata.idMetadata.getIdFilter(this.id))}async delete(){this.__clearErrorsAndReportChanged();let t=this.buildLifeCycleEvent();this.remult.dataProvider.isProxy||this.info.entityInfo.deleting&&await this.info.entityInfo.deleting(this.instance,t),this.__assertValidity();try{if(await this.edp.delete(this.id),this.remult.dataProvider.isProxy||this.info.entityInfo.deleted&&await this.info.entityInfo.deleted(this.instance,t),this.repository.listeners)for(const n of this.repository.listeners.filter(i=>i.deleted))await n.deleted(this.instance);await this.repository.remult.liveQueryPublisher.itemChanged(this.repository.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!0}]),this._wasDeleted=!0}catch(n){await this.catchSaveErrors(n)}}async loadDataFrom(t,n){for(const i of this.info.fields){let s=this.lookups.get(i.key);s?(s.id=t[i.key],n===void 0?!i.options.lazy&&!H(i)&&await s.waitLoad():n.includes(i)&&await s.waitLoad()):H(i)||(this.instance[i.key]=t[i.key])}await this.calcServerExpression(),this.id=this.getId()}getOriginalId(){return this.originalId}async calcServerExpression(){if(_s())for(const t of this.info.fieldsMetadata)t.options.serverExpression&&(this.instance[t.key]=await t.options.serverExpression(this.instance))}isNew(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._isNew}wasChanged(){var t;(t=this._subscribers)==null||t.reportObserved();for(const n of this.fields){const i=H(n.metadata);if((!i||i.type=="reference")&&n.valueChanged())return!0}return!1}async __performColumnAndEntityValidations(){for(const t of this.fieldsMetadata)t.options.validate&&await new Vn(t.options,t,this.instance,this,this).__performValidation();if(this.info.entityInfo.validation){let t=this.buildLifeCycleEvent(()=>{});await this.info.entityInfo.validation(this.instance,t)}if(this.repository.listeners)for(const t of this.repository.listeners.filter(n=>n.validating))await t.validating(this.instance)}}function As(r,e){return r.map(t=>Ms(t.settings(e),e))}class Vn{constructor(e,t,n,i,s){c(this,"settings");c(this,"metadata");c(this,"container");c(this,"helper");c(this,"rowBase");c(this,"_subscribers");c(this,"target");c(this,"entityRef");this.settings=e,this.metadata=t,this.container=n,this.helper=i,this.rowBase=s,this.target=this.settings.target,this.entityRef=this.helper}subscribe(e){return this._subscribers||this.rowBase.initSubscribers(),this._subscribers.subscribe(e)}valueIsNull(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id===void 0||e.id===null:this.value===null}originalValueIsNull(){return this.reportObserved(),this.rowBase.lookups.get(this.metadata.key),this.rawOriginalValue()===null}async load(){let e=this.rowBase.lookups.get(this.metadata.key),t=H(this.metadata);if(t){if(t.type==="toMany")return this.container[this.metadata.key]=await this.helper.repository.relations(this.container)[this.metadata.key].find();{let n=await this.helper.repository.relations(this.container)[this.metadata.key].findOne();if(n)this.container[this.metadata.key]=n;else return null}}else if(e)return this.valueChanged()&&await e.waitLoadOf(this.rawOriginalValue()),await e.waitLoad();return this.value}reportObserved(){var e,t;(e=this._subscribers)==null||e.reportObserved(),(t=this.rowBase._subscribers)==null||t.reportObserved()}reportChanged(){var e,t;(e=this._subscribers)==null||e.reportChanged(),(t=this.rowBase._subscribers)==null||t.reportChanged()}get error(){if(this.reportObserved(),!!this.rowBase.errors)return this.rowBase.errors[this.metadata.key]}set error(e){this.rowBase.errors||(this.rowBase.errors={}),this.rowBase.errors[this.metadata.key]=e,this.reportChanged()}get displayValue(){return this.reportObserved(),this.value!=null?this.settings.displayValue?this.settings.displayValue(this.container,this.value):this.metadata.valueConverter.displayValue?this.metadata.valueConverter.displayValue(this.value):this.value.toString():""}get value(){return this.container[this.metadata.key]}set value(e){this.container[this.metadata.key]=e}get originalValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.get(this.rawOriginalValue()):this.rowBase.originalValues[this.metadata.key]}rawOriginalValue(){return this.rowBase.originalValues[this.metadata.key]}setId(e){this.value=e}getId(){let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id:null:this.value}get inputValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id.toString():null:this.metadata.valueConverter.toInput(this.value,this.settings.inputType)}set inputValue(e){let t=this.rowBase.lookups.get(this.metadata.key);t?t.setId(e):this.value=this.metadata.valueConverter.fromInput(e,this.settings.inputType)}valueChanged(){this.reportObserved();let e=this.value,t=this.rowBase.lookups.get(this.metadata.key);return t&&(e=t.id),JSON.stringify(this.metadata.valueConverter.toJson(this.rowBase.originalValues[this.metadata.key]))!=JSON.stringify(this.metadata.valueConverter.toJson(e))}async __performValidation(){var e;try{const t=n=>{n!==!0&&n!==void 0&&!this.error&&(typeof n=="string"&&n.length>0?this.error=n:this.error="invalid value")};if(this.settings.validate){let n=this,i={entityRef:this.entityRef,get error(){return n.error},set error(s){n.error=s},isNew:(e=this.entityRef)==null?void 0:e.isNew(),load:()=>n.load(),metadata:n.metadata,originalValue:n.originalValue,value:n.value,valueChanged:()=>n.valueChanged(),originalValueIsNull:()=>n.originalValueIsNull(),valueIsNull:()=>n.valueIsNull(),isBackend:()=>{var s,o,a;return!((a=(o=(s=n.rowBase)==null?void 0:s.remult)==null?void 0:o.dataProvider)!=null&&a.isProxy)}};if(Array.isArray(this.settings.validate))for(const s of this.settings.validate)t(await s(this.container,i));else typeof this.settings.validate=="function"&&t(await this.settings.validate(this.container,i))}}catch(t){typeof t=="string"?this.error=t:this.error=t.message}}async validate(){return await this.__performValidation(),!this.error}}let Fs={transformCaption:(r,e,t,n)=>t};const Ps=E.captionTransformer||(E.captionTransformer=Fs);function yr(r,e,t,n){let i;return typeof r=="function"?t&&(i=r(t)):r&&(i=r),i=Ps.transformCaption(t,e,i,n),i||(e?ns(e):"")}class Ds{constructor(e,t,n){c(this,"settings");c(this,"entityDefs");c(this,"remult");c(this,"options");c(this,"target");c(this,"readonly");c(this,"valueConverter");c(this,"allowNull");c(this,"caption");c(this,"dbName");c(this,"inputType");c(this,"key");c(this,"isServerExpression");c(this,"valueType");this.settings=e,this.entityDefs=t,this.remult=n,this.options=this.settings,this.target=this.settings.target,this.valueConverter=new Proxy(this.settings.valueConverter,{get:(i,s)=>{let o=i[s];return typeof o=="function"?(...a)=>{try{return i[s](...a)}catch(l){const u=`${String(s)} failed for value ${a==null?void 0:a[0]}. Error: ${typeof l=="string"?l:l.message}`;throw{message:this.caption+": "+u,modelState:{[this.key]:u}}}}:o}}),this.allowNull=!!this.settings.allowNull,this.valueType=this.settings.valueType,this.key=this.settings.key,this.inputType=this.settings.inputType,e.serverExpression&&(this.isServerExpression=!0),typeof this.settings.allowApiUpdate=="boolean"&&(this.readonly=this.settings.allowApiUpdate),this.inputType||(this.inputType=this.valueConverter.inputType),this.dbName=e.dbName,this.dbName==null&&(this.dbName=e.key),this.caption=yr(e.caption,e.key,n,t)}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!0:this.remult.isAllowedForInstance(e,this.options.allowApiUpdate)}displayValue(e){return this.entityDefs.getEntityMetadataWithoutBreakingTheEntity(e).fields.find(this.key).displayValue}includedInApi(e){return this.options.includeInApi===void 0?!0:this.remult.isAllowedForInstance(e,this.options.includeInApi)}toInput(e,t){return this.valueConverter.toInput(e,t)}fromInput(e,t){return this.valueConverter.fromInput(e,t)}async getDbName(){return wr(this,this.entityDefs)}get dbReadOnly(){return this.settings.dbReadOnly}}class Rs{constructor(e,t,n,i,s){c(this,"entityInfo");c(this,"remult");c(this,"entityType");c(this,"key");c(this,"options");c(this,"fieldsMetadata",[]);c(this,"idMetadata",{getId:e=>{if(e==null)return e;const t=W(e,!1);return t?t.getId():this.idMetadata.field instanceof ke?this.idMetadata.field.getId(e):e[this.idMetadata.field.key]},field:void 0,createIdInFilter:e=>{if(e.length>0)return{$or:e.map(t=>this.idMetadata.getIdFilter(W(t).getId()))}},isIdField:e=>e.key==this.idMetadata.field.key,getIdFilter:(...e)=>{if(this.idMetadata.field instanceof ke){let t=this.idMetadata.field;return{$or:e.map(n=>t.isEqualTo(n))}}return e.length==1?{[this.idMetadata.field.key]:e[0]}:{[this.idMetadata.field.key]:e}}});c(this,"fields");c(this,"dbName");c(this,"caption");if(this.entityInfo=t,this.remult=n,this.entityType=i,this.key=s,this.options=t,this.options.allowApiCrud!==void 0){let a;typeof this.options.allowApiCrud=="function"?a=(l,u)=>this.options.allowApiCrud(u):a=this.options.allowApiCrud,this.options.allowApiDelete===void 0&&(this.options.allowApiDelete=a),this.options.allowApiInsert===void 0&&(this.options.allowApiInsert=a),this.options.allowApiUpdate===void 0&&(this.options.allowApiUpdate=a),this.options.allowApiRead===void 0&&(this.options.allowApiRead=this.options.allowApiCrud)}this.options.allowApiRead===void 0&&(this.options.allowApiRead=!0),this.key||(this.key=i.name),t.dbName||(t.dbName=this.key),this.dbName=t.dbName;let o={find:a=>o[typeof a=="string"?a:a.key],[Symbol.iterator]:()=>this.fieldsMetadata[Symbol.iterator](),toArray:()=>this.fieldsMetadata};for(const a of e)this.fieldsMetadata.push(o[a.key]=new Ds(a,this,n));if(this.fields=o,this.caption=yr(t.caption,this.key,n,this),t.id){let a=typeof t.id=="function"?t.id(this.fields):Object.keys(t.id).map(l=>this.fields.find(l));Array.isArray(a)?a.length>1?this.idMetadata.field=new ke(...a):a.length==1&&(this.idMetadata.field=a[0]):this.idMetadata.field=a}this.idMetadata.field||(this.fields.id?this.idMetadata.field=this.fields.id:this.idMetadata.field=[...this.fields][0])}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiUpdateAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiUpdate)}get apiReadAllowed(){return this.options.allowApiRead===void 0?!0:this.remult.isAllowed(this.options.allowApiRead)}apiDeleteAllowed(e){return this.options.allowApiDelete===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiDeleteAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiDelete)}apiInsertAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiInsertAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiInsert)}getEntityMetadataWithoutBreakingTheEntity(e){let t=W(e,!1);return t||this.remult.repo(this.entityType).getEntityRef({...e})}getDbName(){return Ns(this)}}const Ls=Symbol.for("storableMember");function mr(r,e){let t={};for(const n of r)n&&(typeof n=="function"?n(t,e):Object.assign(t,n));return t}function Ms(r,e){if(r.valueType){let t=r.valueType[Ls];t&&(r={...mr(t,e),...r})}if(r.valueType==String){let t=r;r.valueConverter||(t.valueConverter=se.String)}if(r.valueType==Number){let t=r;r.valueConverter||(t.valueConverter=se.Number)}if(r.valueType==Date){let t=r;r.valueConverter||(t.valueConverter=se.Date)}if(r.valueType==Boolean){let t=r;t.valueConverter||(t.valueConverter=se.Boolean)}if(!r.valueConverter){if(me(r.valueType,!1)){let n;r.valueConverter={toDb:i=>i,fromDb:i=>i},r.valueConverter=new Proxy(r.valueConverter,{get(i,s){if(i[s]===void 0&&n===void 0){if(s==="inputType")return"";n=e.repo(r.valueType).metadata.idMetadata.field.valueType===Number;for(const o of["fieldTypeInDb","toJson","fromJson","toDb","fromDb"])i[o]=n?se.Integer[o]:se.String[o]}return i[s]},set(i,s,o,a){return i[s]=o,!0}})}else r.valueConverter=se.Default;return r}return r.valueConverter.toJson||(r.valueConverter.toJson=t=>t),r.valueConverter.fromJson||(r.valueConverter.fromJson=t=>t),r.valueConverter.toDb||(r.valueConverter.toDb=t=>r.valueConverter.toJson(t)),r.valueConverter.fromDb||(r.valueConverter.fromDb=t=>r.valueConverter.fromJson(t)),r.valueConverter.toInput||(r.valueConverter.toInput=t=>r.valueConverter.toJson(t)),r.valueConverter.fromInput||(r.valueConverter.fromInput=t=>r.valueConverter.fromJson(t)),r}class gr{get _(){return W(this)}save(){return W(this).save()}assign(e){return pr(this,e),this}delete(){return this._.delete()}isNew(){return this._.isNew()}get $(){return this._.fields}}class Bs{constructor(e,t){c(this,"options");c(this,"repo");c(this,"_count");this.options=e,this.repo=t,this.options||(this.options={}),this.options.pageSize||(this.options.pageSize=Os.defaultPageSize)}async getPage(e){return e<1&&(e=1),this.repo.find({where:this.options.where,orderBy:this.options.orderBy,limit:this.options.pageSize,page:e,load:this.options.load,include:this.options.include})}async count(){return this._count===void 0&&(this._count=await this.repo.count(this.options.where)),this._count}async forEach(e){let t=0;for await(const n of this)await e(n),t++;return t}async paginator(e){this.options.orderBy=ue.createUniqueEntityOrderBy(this.repo.metadata,this.options.orderBy);let t=await this.repo.find({where:{$and:[this.options.where,e]},orderBy:this.options.orderBy,limit:this.options.pageSize,load:this.options.load,include:this.options.include}),n,i=t.length==this.options.pageSize;if(i){let s=await this.repo.createAfterFilter(this.options.orderBy,t[t.length-1]);n=()=>this.paginator(s)}return{count:()=>this.count(),hasNextPage:i,items:t,nextPage:n}}[Symbol.asyncIterator](){this.options.where||(this.options.where={});let e=this.options.orderBy;this.options.orderBy=ue.createUniqueEntityOrderBy(this.repo.metadata,e);let t=-1,n,i,s=0;return i=async()=>{if(this.options.progress&&this.options.progress.progress(s++/await this.count()),n===void 0||t==n.items.length){if(n&&!n.hasNextPage)return{value:void 0,done:!0};let o=n;if(n?n=await n.nextPage():n=await this.paginator(),t=0,n.items.length==0)return{value:void 0,done:!0};if((o==null?void 0:o.items.length)>0&&this.repo.getEntityRef(o.items[0]).getId()==this.repo.getEntityRef(n.items[0]).getId())throw new Error("pagination failure, returned same first row")}if(t<n.items.length)return{value:n.items[t++],done:!1}},{next:async()=>i()}}}class ht{constructor(){c(this,"_subscribers")}reportChanged(){this._subscribers&&this._subscribers.forEach(e=>e.reportChanged())}reportObserved(){this._subscribers&&this._subscribers.forEach(e=>e.reportObserved())}subscribe(e){let t;return typeof e=="function"?t={reportChanged:()=>e(),reportObserved:()=>{}}:t=e,this._subscribers||(this._subscribers=[]),this._subscribers.push(t),()=>this._subscribers=this._subscribers.filter(n=>n!=t)}}async function Ns(r,e=t=>t){if(r.options.sqlExpression){if(typeof r.options.sqlExpression=="string")return r.options.sqlExpression;if(typeof r.options.sqlExpression=="function")return await r.options.sqlExpression(r)}return e(r.dbName)}async function wr(r,e,t=n=>n){try{if(r.options.sqlExpression){let s;if(typeof r.options.sqlExpression=="function"){const o=r.options.sqlExpression;try{r.options.sqlExpression="recursive sqlExpression call for field '"+r.key+"'. ",s=await o(e),r.options.sqlExpression=()=>s}finally{}}else s=r.options.sqlExpression;return s||r.dbName}const n=H(r);let i=(n==null?void 0:n.type)==="toOne"&&r.options.field;if(i){let s=e.fields.find(i);if(s)return wr(s,e,t)}return t(r.dbName)}finally{}}var wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_e={},N={},ee={};Object.defineProperty(ee,"__esModule",{value:!0});ee.output=ee.exists=ee.hash=ee.bytes=ee.bool=ee.number=void 0;function bt(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}ee.number=bt;function br(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}ee.bool=br;function js(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function mn(r,...e){if(!js(r))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}ee.bytes=mn;function vr(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");bt(r.outputLen),bt(r.blockLen)}ee.hash=vr;function kr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}ee.exists=kr;function _r(r,e){mn(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}ee.output=_r;const Js={number:bt,bool:br,bytes:mn,hash:vr,exists:kr,output:_r};ee.default=Js;var S={};Object.defineProperty(S,"__esModule",{value:!0});S.add5L=S.add5H=S.add4H=S.add4L=S.add3H=S.add3L=S.add=S.rotlBL=S.rotlBH=S.rotlSL=S.rotlSH=S.rotr32L=S.rotr32H=S.rotrBL=S.rotrBH=S.rotrSL=S.rotrSH=S.shrSL=S.shrSH=S.toBig=S.split=S.fromBig=void 0;const pt=BigInt(2**32-1),Xt=BigInt(32);function gn(r,e=!1){return e?{h:Number(r&pt),l:Number(r>>Xt&pt)}:{h:Number(r>>Xt&pt)|0,l:Number(r&pt)|0}}S.fromBig=gn;function Or(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=gn(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}S.split=Or;const Ir=(r,e)=>BigInt(r>>>0)<<Xt|BigInt(e>>>0);S.toBig=Ir;const Er=(r,e,t)=>r>>>t;S.shrSH=Er;const Cr=(r,e,t)=>r<<32-t|e>>>t;S.shrSL=Cr;const Sr=(r,e,t)=>r>>>t|e<<32-t;S.rotrSH=Sr;const Tr=(r,e,t)=>r<<32-t|e>>>t;S.rotrSL=Tr;const Ar=(r,e,t)=>r<<64-t|e>>>t-32;S.rotrBH=Ar;const Fr=(r,e,t)=>r>>>t-32|e<<64-t;S.rotrBL=Fr;const Pr=(r,e)=>e;S.rotr32H=Pr;const Dr=(r,e)=>r;S.rotr32L=Dr;const Rr=(r,e,t)=>r<<t|e>>>32-t;S.rotlSH=Rr;const Lr=(r,e,t)=>e<<t|r>>>32-t;S.rotlSL=Lr;const Mr=(r,e,t)=>e<<t-32|r>>>64-t;S.rotlBH=Mr;const Br=(r,e,t)=>r<<t-32|e>>>64-t;S.rotlBL=Br;function Nr(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}S.add=Nr;const jr=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0);S.add3L=jr;const Jr=(r,e,t,n)=>e+t+n+(r/2**32|0)|0;S.add3H=Jr;const qr=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0);S.add4L=qr;const xr=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0;S.add4H=xr;const Ur=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0);S.add5L=Ur;const Hr=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0;S.add5H=Hr;const qs={fromBig:gn,split:Or,toBig:Ir,shrSH:Er,shrSL:Cr,rotrSH:Sr,rotrSL:Tr,rotrBH:Ar,rotrBL:Fr,rotr32H:Pr,rotr32L:Dr,rotlSH:Rr,rotlSL:Lr,rotlBH:Mr,rotlBL:Br,add:Nr,add3L:jr,add3H:Jr,add4L:qr,add4H:xr,add5H:Hr,add5L:Ur};S.default=qs;var Vr={},It={};Object.defineProperty(It,"__esModule",{value:!0});It.crypto=void 0;It.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(r){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.randomBytes=r.wrapXOFConstructorWithOpts=r.wrapConstructorWithOpts=r.wrapConstructor=r.checkOpts=r.Hash=r.concatBytes=r.toBytes=r.utf8ToBytes=r.asyncLoop=r.nextTick=r.hexToBytes=r.bytesToHex=r.isLE=r.rotr=r.createView=r.u32=r.u8=void 0;const e=It,t=w=>new Uint8Array(w.buffer,w.byteOffset,w.byteLength);r.u8=t;const n=w=>new Uint32Array(w.buffer,w.byteOffset,Math.floor(w.byteLength/4));r.u32=n;function i(w){return w instanceof Uint8Array||w!=null&&typeof w=="object"&&w.constructor.name==="Uint8Array"}const s=w=>new DataView(w.buffer,w.byteOffset,w.byteLength);r.createView=s;const o=(w,P)=>w<<32-P|w>>>P;if(r.rotr=o,r.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!r.isLE)throw new Error("Non little-endian hardware is not supported");const a=Array.from({length:256},(w,P)=>P.toString(16).padStart(2,"0"));function l(w){if(!i(w))throw new Error("Uint8Array expected");let P="";for(let J=0;J<w.length;J++)P+=a[w[J]];return P}r.bytesToHex=l;const u={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function f(w){if(w>=u._0&&w<=u._9)return w-u._0;if(w>=u._A&&w<=u._F)return w-(u._A-10);if(w>=u._a&&w<=u._f)return w-(u._a-10)}function d(w){if(typeof w!="string")throw new Error("hex string expected, got "+typeof w);const P=w.length,J=P/2;if(P%2)throw new Error("padded hex string expected, got unpadded hex of length "+P);const j=new Uint8Array(J);for(let q=0,Y=0;q<J;q++,Y+=2){const Ce=f(w.charCodeAt(Y)),qe=f(w.charCodeAt(Y+1));if(Ce===void 0||qe===void 0){const at=w[Y]+w[Y+1];throw new Error('hex string expected, got non-hex character "'+at+'" at index '+Y)}j[q]=Ce*16+qe}return j}r.hexToBytes=d;const p=async()=>{};r.nextTick=p;async function g(w,P,J){let j=Date.now();for(let q=0;q<w;q++){J(q);const Y=Date.now()-j;Y>=0&&Y<P||(await(0,r.nextTick)(),j+=Y)}}r.asyncLoop=g;function k(w){if(typeof w!="string")throw new Error(`utf8ToBytes expected string, got ${typeof w}`);return new Uint8Array(new TextEncoder().encode(w))}r.utf8ToBytes=k;function _(w){if(typeof w=="string"&&(w=k(w)),!i(w))throw new Error(`expected Uint8Array, got ${typeof w}`);return w}r.toBytes=_;function C(...w){let P=0;for(let j=0;j<w.length;j++){const q=w[j];if(!i(q))throw new Error("Uint8Array expected");P+=q.length}const J=new Uint8Array(P);for(let j=0,q=0;j<w.length;j++){const Y=w[j];J.set(Y,q),q+=Y.length}return J}r.concatBytes=C;class M{clone(){return this._cloneInto()}}r.Hash=M;const b={}.toString;function ne(w,P){if(P!==void 0&&b.call(P)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(w,P)}r.checkOpts=ne;function de(w){const P=j=>w().update(_(j)).digest(),J=w();return P.outputLen=J.outputLen,P.blockLen=J.blockLen,P.create=()=>w(),P}r.wrapConstructor=de;function Et(w){const P=(j,q)=>w(q).update(_(j)).digest(),J=w({});return P.outputLen=J.outputLen,P.blockLen=J.blockLen,P.create=j=>w(j),P}r.wrapConstructorWithOpts=Et;function Ct(w){const P=(j,q)=>w(q).update(_(j)).digest(),J=w({});return P.outputLen=J.outputLen,P.blockLen=J.blockLen,P.create=j=>w(j),P}r.wrapXOFConstructorWithOpts=Ct;function St(w=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(w));throw new Error("crypto.getRandomValues must be defined")}r.randomBytes=St})(Vr);Object.defineProperty(N,"__esModule",{value:!0});N.shake256=N.shake128=N.keccak_512=N.keccak_384=N.keccak_256=N.keccak_224=N.sha3_512=N.sha3_384=N.sha3_256=N.sha3_224=N.Keccak=N.keccakP=void 0;const Pe=ee,et=S,ze=Vr,[Wr,Kr,$r]=[[],[],[]],xs=BigInt(0),xe=BigInt(1),Us=BigInt(2),Hs=BigInt(7),Vs=BigInt(256),Ws=BigInt(113);for(let r=0,e=xe,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],Wr.push(2*(5*n+t)),Kr.push((r+1)*(r+2)/2%64);let i=xs;for(let s=0;s<7;s++)e=(e<<xe^(e>>Hs)*Ws)%Vs,e&Us&&(i^=xe<<(xe<<BigInt(s))-xe);$r.push(i)}const[Ks,$s]=(0,et.split)($r,!0),Wn=(r,e,t)=>t>32?(0,et.rotlBH)(r,e,t):(0,et.rotlSH)(r,e,t),Kn=(r,e,t)=>t>32?(0,et.rotlBL)(r,e,t):(0,et.rotlSL)(r,e,t);function Qr(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,u=t[l],f=t[l+1],d=Wn(u,f,1)^t[a],p=Kn(u,f,1)^t[a+1];for(let g=0;g<50;g+=10)r[o+g]^=d,r[o+g+1]^=p}let i=r[2],s=r[3];for(let o=0;o<24;o++){const a=Kr[o],l=Wn(i,s,a),u=Kn(i,s,a),f=Wr[o];i=r[f],s=r[f+1],r[f]=l,r[f+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Ks[n],r[1]^=$s[n]}t.fill(0)}N.keccakP=Qr;class ot extends ze.Hash{constructor(e,t,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,Pe.number)(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,ze.u32)(this.state)}keccak(){Qr(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){(0,Pe.exists)(this);const{blockLen:t,state:n}=this;e=(0,ze.toBytes)(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:i}=this;e[n]^=t,t&128&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,Pe.exists)(this,!1),(0,Pe.bytes)(e),this.finish();const t=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,Pe.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,Pe.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new ot(t,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}N.Keccak=ot;const Oe=(r,e,t)=>(0,ze.wrapConstructor)(()=>new ot(e,r,t));N.sha3_224=Oe(6,144,224/8);N.sha3_256=Oe(6,136,256/8);N.sha3_384=Oe(6,104,384/8);N.sha3_512=Oe(6,72,512/8);N.keccak_224=Oe(1,144,224/8);N.keccak_256=Oe(1,136,256/8);N.keccak_384=Oe(1,104,384/8);N.keccak_512=Oe(1,72,512/8);const Gr=(r,e,t)=>(0,ze.wrapXOFConstructorWithOpts)((n={})=>new ot(e,r,n.dkLen===void 0?t:n.dkLen,!0));N.shake128=Gr(31,168,128/8);N.shake256=Gr(31,136,256/8);const{sha3_512:Qs}=N,zr=24,Xe=32,Yt=(r=4,e=Math.random)=>{let t="";for(;t.length<r;)t=t+Math.floor(e()*36).toString(36);return t};function Xr(r){let e=8n,t=0n;for(const n of r.values()){const i=BigInt(n);t=(t<<e)+i}return t}const Yr=(r="")=>Xr(Qs(r)).toString(36).slice(1),$n=Array.from({length:26},(r,e)=>String.fromCharCode(e+97)),Gs=r=>$n[Math.floor(r()*$n.length)],Zr=({globalObj:r=typeof wt<"u"?wt:typeof window<"u"?window:{},random:e=Math.random}={})=>{const t=Object.keys(r).toString(),n=t.length?t+Yt(Xe,e):Yt(Xe,e);return Yr(n).substring(0,Xe)},ei=r=>()=>r++,zs=476782367,ti=({random:r=Math.random,counter:e=ei(Math.floor(r()*zs)),length:t=zr,fingerprint:n=Zr({random:r})}={})=>function(){const s=Gs(r),o=Date.now().toString(36),a=e().toString(36),l=Yt(t,r),u=`${o+l+a+n}`;return`${s+Yr(u).substring(1,t)}`},Xs=ti(),Ys=(r,{minLength:e=2,maxLength:t=Xe}={})=>{const n=r.length,i=/^[0-9a-z]+$/;try{if(typeof r=="string"&&n>=e&&n<=t&&i.test(r))return!0}finally{}return!1};_e.getConstants=()=>({defaultLength:zr,bigLength:Xe});_e.init=ti;_e.createId=Xs;_e.bufToBigInt=Xr;_e.createCounter=ei;_e.createFingerprint=Zr;_e.isCuid=Ys;const{createId:Zs,init:la,getConstants:ua,isCuid:fa}=_e;var Qn=Zs;const Z=class Z{};c(Z,"required",$e(async(e,t)=>t.value!=null&&t.value!=null&&t.value!==""&&t.value!=0,"Should not be empty")),c(Z,"unique",$e(async(e,t)=>{if(!t.entityRef)throw"unique validation may only work on columns that are attached to an entity";return t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0},"already exists")),c(Z,"uniqueOnBackend",$e(async(e,t)=>t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0,Z.unique.defaultMessage)),c(Z,"regex",Ue((e,t)=>t.test(e))),c(Z,"email",jt(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),"Invalid Email")),c(Z,"url",jt(e=>!!new URL(e),"Invalid Url")),c(Z,"in",Ue((e,t)=>t.includes(e),e=>`Value must be one of ${e.join(", ")}`)),c(Z,"notNull",jt(e=>e!=null,"Should not be null")),c(Z,"enum",Ue((e,t)=>Object.values(t).includes(e),e=>`Value must be one of ${Object.values(e).filter(t=>typeof e[t]!="number").join(", ")}`)),c(Z,"relationExists",$e(async(e,t)=>t.valueIsNull()||!t.isBackend()?!0:!!await t.load(),"Relation value does not exist")),c(Z,"maxLength",Ue((e,t)=>e.length<=t,e=>`Value must be at most ${e} characters`)),c(Z,"minLength",Ue((e,t)=>e.length>=t,e=>`Value must be at least ${e} characters`)),c(Z,"defaultMessage","Invalid value");let Ee=Z;function $e(r,e){const t=async(i,s,o)=>{const a=await r(i,s);typeof a=="string"&&a.length>0?s.error=a:a||(s.error=typeof o=="function"&&o(i,s,void 0)||o||typeof e=="function"&&e(i,s,void 0)||e||Ee.defaultMessage)},n=(i,s,o)=>typeof i=="string"||i==="function"||i===void 0&&s===void 0?async(a,l,u)=>await t(a,l,i||u):t(i,s,o);return Object.defineProperty(n,"defaultMessage",{get:()=>e,set:i=>{e=i},enumerable:!0}),Object.assign(n,{withMessage:i=>async(s,o)=>n(s,o,i)})}function jt(r,e){return $e((t,n)=>n.value===void 0||n.value===null?!0:r(n.value),e)}function Ue(r,e){const t=eo((n,i,s)=>i.value===void 0||i.value===null?!0:r(i.value,s),(n,i,s)=>typeof e=="function"&&e(s)||e,!0);return Object.assign((n,i)=>t(n,i),{get defaultMessage(){return e},set defaultMessage(n){e=n}})}function eo(r,e,t=!1){return Object.assign((i,s)=>async(o,a)=>{const l=await r(o,a,i);typeof l=="string"?a.error=l:l||(a.error=s?typeof s=="function"?t?s(i):s(o,a,i):s:e?typeof e=="function"?e(o,a,i):e:Ee.defaultMessage)},{get defaultMessage(){return e},set defaultMessage(i){e=i}})}class to{static object(...e){return re(void 0,...e)}static json(...e){let t=e;return t.valueConverter&&!t.valueConverter.fieldTypeInDb&&(t.valueConverter.fieldTypeInDb="json"),re(void 0,{valueConverter:{fieldTypeInDb:"json"}},...e)}static dateOnly(...e){return re(()=>Date,{valueConverter:se.DateOnly},...e)}static date(...e){return re(()=>Date,...e)}static integer(...e){return re(()=>Number,{valueConverter:se.Integer},...e)}static autoIncrement(...e){return re(()=>Number,{allowApiUpdate:!1,dbReadOnly:!0,valueConverter:{...se.Integer,fieldTypeInDb:"autoincrement"}},...e)}static number(...e){return re(()=>Number,...e)}static createdAt(...e){return re(()=>Date,{allowApiUpdate:!1,saving:(t,n,{isNew:i})=>{i&&(n.value=new Date)}},...e)}static updatedAt(...e){return re(()=>Date,{allowApiUpdate:!1,saving:(t,n)=>{n.value=new Date}},...e)}static uuid(...e){return re(()=>String,{allowApiUpdate:!1,defaultValue:()=>zt(),saving:(t,n)=>{n.value||(n.value=zt())}},...e)}static cuid(...e){return re(()=>String,{allowApiUpdate:!1,defaultValue:()=>Qn(),saving:(t,n)=>{n.value||(n.value=Qn())}},...e)}static string(...e){return re(()=>String,...e)}static boolean(...e){return re(()=>Boolean,...e)}}function re(r,...e){return(t,n,i)=>{const s=typeof n=="string"?n:n.name.toString();let o=u=>{let f=mr(e,u);f.required&&(f.validate=Jt(f.validate,Ee.required)),f.maxLength&&(f.validate=Jt(f.validate,Ee.maxLength(f.maxLength))),f.minLength&&(f.validate=Jt(f.validate,Ee.minLength(f.minLength))),!f.valueType&&r&&(f.valueType=r()),f.key||(f.key=s),f.dbName||(f.dbName=f.key);let d=f.valueType;return d||(d=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:type",t,s):[],f.valueType=d),f.target||(f.target=t),f};no(t);let a=E.columnsOfType.get(t.constructor);a||(a=[],E.columnsOfType.set(t.constructor,a));let l=a.find(u=>u.key==s);if(!l)a.push({key:s,settings:o});else{let u=l.settings;l.settings=f=>{let d=u(f),p=o(f);return Object.assign(d,p)}}}}function no(r){if(!r)throw new Error("Set the 'experimentalDecorators:true' option in your 'tsconfig' or 'jsconfig' (target undefined)")}function Jt(r,e,t=!1){if(!e)return;const n=Array.isArray(e)?e:[e],i=Array.isArray(r)?r:r?[r]:[];return t?[...n,...i]:[...i,...n]}function ro(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function io(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}class so extends gr{constructor(){super(...arguments);c(this,"id")}}ro([to.uuid(),io("design:type",String)],so.prototype,"id",void 0);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Gn;(function(r){(function(e){var t=typeof wt=="object"?wt:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof t.Reflect>"u"?t.Reflect=r:n=i(t.Reflect,n),e(n);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,u={create:o?function(){return At(Object.create(null))}:a?function(){return At({__proto__:null})}:function(){return At({})},has:l?function(h,y){return t.call(h,y)}:function(h,y){return y in h},get:l?function(h,y){return t.call(h,y)?h[y]:void 0}:function(h,y){return h[y]}},f=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",p=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:bi(),g=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:vi(),k=!d&&typeof WeakMap=="function"?WeakMap:ki(),_=new k;function C(h,y,m,v){if(V(m)){if(!_n(h))throw new TypeError;if(!On(y))throw new TypeError;return J(h,y)}else{if(!_n(h))throw new TypeError;if(!$(y))throw new TypeError;if(!$(v)&&!V(v)&&!Se(v))throw new TypeError;return Se(v)&&(v=void 0),m=pe(m),j(h,y,m,v)}}e("decorate",C);function M(h,y){function m(v,O){if(!$(v))throw new TypeError;if(!V(O)&&!pi(O))throw new TypeError;wn(h,y,v,O)}return m}e("metadata",M);function b(h,y,m,v){if(!$(m))throw new TypeError;return V(v)||(v=pe(v)),wn(h,y,m,v)}e("defineMetadata",b);function ne(h,y,m){if(!$(y))throw new TypeError;return V(m)||(m=pe(m)),Y(h,y,m)}e("hasMetadata",ne);function de(h,y,m){if(!$(y))throw new TypeError;return V(m)||(m=pe(m)),Ce(h,y,m)}e("hasOwnMetadata",de);function Et(h,y,m){if(!$(y))throw new TypeError;return V(m)||(m=pe(m)),qe(h,y,m)}e("getMetadata",Et);function Ct(h,y,m){if(!$(y))throw new TypeError;return V(m)||(m=pe(m)),at(h,y,m)}e("getOwnMetadata",Ct);function St(h,y){if(!$(h))throw new TypeError;return V(y)||(y=pe(y)),bn(h,y)}e("getMetadataKeys",St);function w(h,y){if(!$(h))throw new TypeError;return V(y)||(y=pe(y)),vn(h,y)}e("getOwnMetadataKeys",w);function P(h,y,m){if(!$(y))throw new TypeError;V(m)||(m=pe(m));var v=q(y,m,!1);if(V(v)||!v.delete(h))return!1;if(v.size>0)return!0;var O=_.get(y);return O.delete(m),O.size>0||_.delete(y),!0}e("deleteMetadata",P);function J(h,y){for(var m=h.length-1;m>=0;--m){var v=h[m],O=v(y);if(!V(O)&&!Se(O)){if(!On(O))throw new TypeError;y=O}}return y}function j(h,y,m,v){for(var O=h.length-1;O>=0;--O){var Q=h[O],T=Q(y,m,v);if(!V(T)&&!Se(T)){if(!$(T))throw new TypeError;v=T}}return v}function q(h,y,m){var v=_.get(h);if(V(v)){if(!m)return;v=new p,_.set(h,v)}var O=v.get(y);if(V(O)){if(!m)return;O=new p,v.set(y,O)}return O}function Y(h,y,m){var v=Ce(h,y,m);if(v)return!0;var O=Tt(y);return Se(O)?!1:Y(h,O,m)}function Ce(h,y,m){var v=q(y,m,!1);return V(v)?!1:di(v.has(h))}function qe(h,y,m){var v=Ce(h,y,m);if(v)return at(h,y,m);var O=Tt(y);if(!Se(O))return qe(h,O,m)}function at(h,y,m){var v=q(y,m,!1);if(!V(v))return v.get(h)}function wn(h,y,m,v){var O=q(m,v,!0);O.set(h,y)}function bn(h,y){var m=vn(h,y),v=Tt(h);if(v===null)return m;var O=bn(v,y);if(O.length<=0)return m;if(m.length<=0)return O;for(var Q=new g,T=[],F=0,I=m;F<I.length;F++){var R=I[F],L=Q.has(R);L||(Q.add(R),T.push(R))}for(var ge=0,En=O;ge<En.length;ge++){var R=En[ge],L=Q.has(R);L||(Q.add(R),T.push(R))}return T}function vn(h,y){var m=[],v=q(h,y,!1);if(V(v))return m;for(var O=v.keys(),Q=yi(O),T=0;;){var F=gi(Q);if(!F)return m.length=T,m;var I=mi(F);try{m[T]=I}catch(R){try{wi(Q)}finally{throw R}}T++}}function kn(h){if(h===null)return 1;switch(typeof h){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return h===null?1:6;default:return 6}}function V(h){return h===void 0}function Se(h){return h===null}function ui(h){return typeof h=="symbol"}function $(h){return typeof h=="object"?h!==null:typeof h=="function"}function fi(h,y){switch(kn(h)){case 0:return h;case 1:return h;case 2:return h;case 3:return h;case 4:return h;case 5:return h}var m=y===3?"string":y===5?"number":"default",v=In(h,i);if(v!==void 0){var O=v.call(h,m);if($(O))throw new TypeError;return O}return ci(h,m==="default"?"number":m)}function ci(h,y){if(y==="string"){var m=h.toString;if(Te(m)){var v=m.call(h);if(!$(v))return v}var O=h.valueOf;if(Te(O)){var v=O.call(h);if(!$(v))return v}}else{var O=h.valueOf;if(Te(O)){var v=O.call(h);if(!$(v))return v}var Q=h.toString;if(Te(Q)){var v=Q.call(h);if(!$(v))return v}}throw new TypeError}function di(h){return!!h}function hi(h){return""+h}function pe(h){var y=fi(h,3);return ui(y)?y:hi(y)}function _n(h){return Array.isArray?Array.isArray(h):h instanceof Object?h instanceof Array:Object.prototype.toString.call(h)==="[object Array]"}function Te(h){return typeof h=="function"}function On(h){return typeof h=="function"}function pi(h){switch(kn(h)){case 3:return!0;case 4:return!0;default:return!1}}function In(h,y){var m=h[y];if(m!=null){if(!Te(m))throw new TypeError;return m}}function yi(h){var y=In(h,s);if(!Te(y))throw new TypeError;var m=y.call(h);if(!$(m))throw new TypeError;return m}function mi(h){return h.value}function gi(h){var y=h.next();return y.done?!1:y}function wi(h){var y=h.return;y&&y.call(h)}function Tt(h){var y=Object.getPrototypeOf(h);if(typeof h!="function"||h===f||y!==f)return y;var m=h.prototype,v=m&&Object.getPrototypeOf(m);if(v==null||v===Object.prototype)return y;var O=v.constructor;return typeof O!="function"||O===h?y:O}function bi(){var h={},y=[],m=function(){function T(F,I,R){this._index=0,this._keys=F,this._values=I,this._selector=R}return T.prototype["@@iterator"]=function(){return this},T.prototype[s]=function(){return this},T.prototype.next=function(){var F=this._index;if(F>=0&&F<this._keys.length){var I=this._selector(this._keys[F],this._values[F]);return F+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:I,done:!1}}return{value:void 0,done:!0}},T.prototype.throw=function(F){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),F},T.prototype.return=function(F){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:F,done:!0}},T}();return function(){function T(){this._keys=[],this._values=[],this._cacheKey=h,this._cacheIndex=-2}return Object.defineProperty(T.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),T.prototype.has=function(F){return this._find(F,!1)>=0},T.prototype.get=function(F){var I=this._find(F,!1);return I>=0?this._values[I]:void 0},T.prototype.set=function(F,I){var R=this._find(F,!0);return this._values[R]=I,this},T.prototype.delete=function(F){var I=this._find(F,!1);if(I>=0){for(var R=this._keys.length,L=I+1;L<R;L++)this._keys[L-1]=this._keys[L],this._values[L-1]=this._values[L];return this._keys.length--,this._values.length--,F===this._cacheKey&&(this._cacheKey=h,this._cacheIndex=-2),!0}return!1},T.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=h,this._cacheIndex=-2},T.prototype.keys=function(){return new m(this._keys,this._values,v)},T.prototype.values=function(){return new m(this._keys,this._values,O)},T.prototype.entries=function(){return new m(this._keys,this._values,Q)},T.prototype["@@iterator"]=function(){return this.entries()},T.prototype[s]=function(){return this.entries()},T.prototype._find=function(F,I){return this._cacheKey!==F&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=F)),this._cacheIndex<0&&I&&(this._cacheIndex=this._keys.length,this._keys.push(F),this._values.push(void 0)),this._cacheIndex},T}();function v(T,F){return T}function O(T,F){return F}function Q(T,F){return[T,F]}}function vi(){return function(){function h(){this._map=new p}return Object.defineProperty(h.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),h.prototype.has=function(y){return this._map.has(y)},h.prototype.add=function(y){return this._map.set(y,y),this},h.prototype.delete=function(y){return this._map.delete(y)},h.prototype.clear=function(){this._map.clear()},h.prototype.keys=function(){return this._map.keys()},h.prototype.values=function(){return this._map.values()},h.prototype.entries=function(){return this._map.entries()},h.prototype["@@iterator"]=function(){return this.keys()},h.prototype[s]=function(){return this.keys()},h}()}function ki(){var h=16,y=u.create(),m=v();return function(){function I(){this._key=v()}return I.prototype.has=function(R){var L=O(R,!1);return L!==void 0?u.has(L,this._key):!1},I.prototype.get=function(R){var L=O(R,!1);return L!==void 0?u.get(L,this._key):void 0},I.prototype.set=function(R,L){var ge=O(R,!0);return ge[this._key]=L,this},I.prototype.delete=function(R){var L=O(R,!1);return L!==void 0?delete L[this._key]:!1},I.prototype.clear=function(){this._key=v()},I}();function v(){var I;do I="@@WeakMap@@"+F();while(u.has(y,I));return y[I]=!0,I}function O(I,R){if(!t.call(I,m)){if(!R)return;Object.defineProperty(I,m,{value:u.create()})}return I[m]}function Q(I,R){for(var L=0;L<R;++L)I[L]=Math.random()*255|0;return I}function T(I){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(I)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(I)):Q(new Uint8Array(I),I):Q(new Array(I),I)}function F(){var I=T(h);I[6]=I[6]&79|64,I[8]=I[8]&191|128;for(var R="",L=0;L<h;++L){var ge=I[L];(L===4||L===6||L===8)&&(R+="-"),ge<16&&(R+="0"),R+=ge.toString(16).toLowerCase()}return R}}function At(h){return h.__=void 0,delete h.__,h}})})(Gn||(Gn={}));E.actionInfo;const oo="",ao="font-weight: bold",lo="opacity: 0.5",uo="font-style: italic",fo="text-decoration: underline",co="filter: invert(1)",ho="visibility: hidden",po="text-decoration: line-through",yo="color: black",mo="color: red",go="color: green",wo="color: yellow",bo="color: blue",vo="color: #ff00ff",ko="color: cyan",_o="color: white",Oo="color: gray",Io="background-color: black",Eo="background-color: red",Co="background-color: green",So="background-color: yellow",To="background-color: blue",Ao="background-color: #ff00ff",Fo="background-color: cyan",Po="background-color: white",Do="color: #a9a9a9",Ro="color: #ff4500",Lo="color: #7fff00",Mo="color: #ffd700",Bo="color: #1e90ff",No="color: #ff69b4",jo="color: #00ffff",Jo="color: #ffffff",qo="background-color: #a9a9a9",xo="background-color: #ff4500",Uo="background-color: #7fff00",Ho="background-color: #ffd700",Vo="background-color: #1e90ff",Wo="background-color: #ff69b4",Ko="background-color: #00ffff",$o="background-color: #ffffff",Qo=Object.freeze(Object.defineProperty({__proto__:null,bgBlack:Io,bgBlackBright:qo,bgBlue:To,bgBlueBright:Vo,bgCyan:Fo,bgCyanBright:Ko,bgGreen:Co,bgGreenBright:Uo,bgMagenta:Ao,bgMagentaBright:Wo,bgRed:Eo,bgRedBright:xo,bgWhite:Po,bgWhiteBright:$o,bgYellow:So,bgYellowBright:Ho,black:yo,blackBright:Do,blue:bo,blueBright:Bo,bold:ao,cyan:ko,cyanBright:jo,dim:lo,gray:Oo,green:go,greenBright:Lo,hidden:ho,inverse:co,italic:uo,magenta:vo,magentaBright:No,red:mo,redBright:Ro,reset:oo,strikethrough:po,underline:fo,white:_o,whiteBright:Jo,yellow:wo,yellowBright:Mo},Symbol.toStringTag,{value:"Module"})),Go=r=>Qo[r]??void 0,Je=(r,e)=>zo(r,e),Zt="$$KitQL_",en="_KitQL$$",tn="$$KitQLEND$$",zo=(r,e)=>`${Zt}${r}${en}${e}${tn}`;function Xo(r){const e=/\$\$KitQL_(.*?)_KitQL\$\$/g;let t;const n=[];for(;(t=e.exec(r))!==null;)n.push(t[1]);return n}const zn=(r,e)=>{let t=0;const n=[];for(;t!==-1;)t=r.indexOf(e,t),t!==-1&&(n.push(t),t+=e.length);return n},Xn=(...r)=>{const e=[...r],t=[],n=[],i=[];for(let s=0;s<e.length;s++){let o=e[s];if(typeof o!="string")i.push(o);else{const a=o,l=[],u=[...new Set(Xo(a))];for(const d of u){const p=zn(a,`${Zt}${d}${en}`);for(const g of p)l.push({index:g,browser:Go(d)});o=o.replaceAll(`${Zt}${d}${en}`,"%c")}const f=zn(a,tn);for(const d of f)l.push({index:d,browser:""});o=o.replaceAll(tn,"%c");for(const d of l.sort((p,g)=>p.index-g.index))n.push(d.browser);t.push(o)}}return[t.join(" "),...n,...i]},Yn=r=>Je("bold",r),Yo=r=>Je("bgGreen",r),Zo=r=>Je("redBright",r),ea=r=>Je("greenBright",r),ta=r=>Je("bgRedBright",r),qt=r=>Je("bgBlueBright",r);class na{constructor(e,t){c(this,"toolName");c(this,"levelsToShow");c(this,"withDate");c(this,"prefixEmoji");this.toolName=e,this.levelsToShow=(t==null?void 0:t.levelsToShow)??3,this.withDate=(t==null?void 0:t.withDate)??null,this.prefixEmoji=(t==null?void 0:t.prefixEmoji)??""}buildStr(e,t,n,...i){const s=[];if(this.toolName){const o=` ${this.toolName} `;e?s.push(ta(o)):t?s.push(Yo(o)):s.push(qt(o))}if(this.withDate==="dateTime"?s.push(String(qt(`${new Date().toISOString()} `))):this.withDate==="time"&&s.push(String(qt(`${new Date().toISOString().split("T")[1]} `))),e?s.push(Yn(Zo(" ✘"))):t?s.push(Yn(ea(" ✔"))):s.push(""+this.prefixEmoji),n>0){const o=" ".repeat(n);s.push(o)}return s.length===0||s.length===1&&s[0]===""?Xn(...i.flatMap(o=>o)):Xn(s.join(""),...i.flatMap(o=>o))}infoO(e,...t){const n=this.buildStr(!1,!1,e.level,...t);return console.info(...n.flatMap(i=>i)),n}info(...e){const t=this.buildStr(!1,!1,0,...e);return console.info(...t.flatMap(n=>n)),t}successO(e,...t){const n=this.buildStr(!1,!0,e.level,t);return console.info(...n.flatMap(i=>i)),n}success(...e){const t=this.buildStr(!1,!0,0,e);return console.info(...t.flatMap(n=>n)),t}error(...e){const t=this.buildStr(!0,!1,0,e);return console.error(...t.flatMap(n=>n)),t}}new na("remult-kit");function ra(r){return r}const{Error:le}=er,oe="src/lib/modules/auth/components/Login.svelte";function nn(r){let e,t,n,i,s,o,a,l,u,f,d,p,g,k,_,C;const M={c:function(){e=x("form"),t=x("p"),n=ye(r[1]),i=ye(r[2]),s=ce(),o=x("label"),a=ye(`Username
      `),l=x("input"),u=ce(),f=x("label"),d=ye(`Password
      `),p=x("input"),g=ce(),k=x("button"),k.textContent="Login",U(t,oe,48,4,819),te(l,"type","text"),U(l,oe,51,6,882),U(o,oe,49,4,853),te(p,"type","password"),U(p,oe,55,6,989),U(f,oe,53,4,960),U(k,oe,57,4,1054),te(e,"class","s-W59Gs1JvsTvT"),U(e,oe,47,2,774)},m:function(ne,de){z(ne,e,de),B(e,t),B(t,n),B(t,i),B(e,s),B(e,o),B(o,a),B(o,l),Re(l,r[0]),B(e,u),B(e,f),B(f,d),B(f,p),Re(p,r[4]),B(e,g),B(e,k),_||(C=[Le(l,"input",r[9]),_t(st.call(null,l)),Le(p,"input",r[10]),Le(e,"submit",ar(r[6]),!1,!0,!1,!1)],_=!0)},p:function(ne,de){de&2&&yt(n,ne[1]),de&4&&yt(i,ne[2]),de&1&&l.value!==ne[0]&&Re(l,ne[0]),de&16&&p.value!==ne[4]&&Re(p,ne[4])},d:function(ne){ne&&X(e),_=!1,vt(C)}};return K("SvelteRegisterBlock",{block:M,id:nn.name,type:"if",source:"(37:0) {#if view == 'login'}",ctx:r}),M}function rn(r){let e,t,n,i,s,o,a,l,u,f,d,p;const g={c:function(){e=x("form"),t=x("p"),n=ye(r[1]),i=ye(r[2]),s=ce(),o=x("label"),a=ye(`PIN
      `),l=x("input"),u=ce(),f=x("button"),f.textContent="Confirm",U(t,oe,63,4,1164),te(l,"type","number"),te(l,"placeholder","556775"),U(l,oe,66,6,1222),U(o,oe,64,4,1198),U(f,oe,68,4,1319),te(e,"class","s-W59Gs1JvsTvT"),U(e,oe,62,2,1116)},m:function(_,C){z(_,e,C),B(e,t),B(t,n),B(t,i),B(e,s),B(e,o),B(o,a),B(o,l),Re(l,r[5]),B(e,u),B(e,f),d||(p=[Le(l,"input",r[11]),_t(st.call(null,l)),Le(e,"submit",ar(r[7]),!1,!0,!1,!1)],d=!0)},p:function(_,C){C&2&&yt(n,_[1]),C&4&&yt(i,_[2]),C&32&&or(l.value)!==_[5]&&Re(l,_[5])},d:function(_){_&&X(e),d=!1,vt(p)}};return K("SvelteRegisterBlock",{block:g,id:rn.name,type:"if",source:"(52:0) {#if view == 'pin'}",ctx:r}),g}function sn(r){let e,t,n=r[3]=="login"&&nn(r),i=r[3]=="pin"&&rn(r);const s={c:function(){n&&n.c(),e=ce(),i&&i.c(),t=nr()},l:function(a){throw new le("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){n&&n.m(a,l),z(a,e,l),i&&i.m(a,l),z(a,t,l)},p:function(a,[l]){a[3]=="login"?n?n.p(a,l):(n=nn(a),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),a[3]=="pin"?i?i.p(a,l):(i=rn(a),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:fe,o:fe,d:function(a){a&&(X(e),X(t)),n&&n.d(a),i&&i.d(a)}};return K("SvelteRegisterBlock",{block:s,id:sn.name,type:"component",source:"",ctx:r}),s}function ia(r,e,t){let{$$slots:n={},$$scope:i}=e;rt("Login",n,[]);let{remultKitData:s}=e,{view:o="login"}=e,{indentifier:a=""}=e,{msgError:l=""}=e,{msgSuccess:u=""}=e,f,d;async function p(){t(1,l=""),t(2,u="")}const g=()=>{throw new Error("Not impl yet")};r.$$.on_mount.push(function(){s===void 0&&!("remultKitData"in e||r.$$.bound[r.$$.props.remultKitData])&&console.warn("<Login> was created without expected prop 'remultKitData'")});const k=["remultKitData","view","indentifier","msgError","msgSuccess"];Object.keys(e).forEach(b=>{!~k.indexOf(b)&&b.slice(0,2)!=="$$"&&b!=="slot"&&console.warn(`<Login> was created with unknown prop '${b}'`)});function _(){a=this.value,t(0,a)}function C(){f=this.value,t(4,f)}function M(){d=or(this.value),t(5,d)}return r.$$set=b=>{"remultKitData"in b&&t(8,s=b.remultKitData),"view"in b&&t(3,o=b.view),"indentifier"in b&&t(0,a=b.indentifier),"msgError"in b&&t(1,l=b.msgError),"msgSuccess"in b&&t(2,u=b.msgSuccess)},r.$capture_state=()=>({isError:ra,autofocus:st,remultKitData:s,view:o,indentifier:a,msgError:l,msgSuccess:u,password:f,pincode:d,signIn:p,handlePin:g}),r.$inject_state=b=>{"remultKitData"in b&&t(8,s=b.remultKitData),"view"in b&&t(3,o=b.view),"indentifier"in b&&t(0,a=b.indentifier),"msgError"in b&&t(1,l=b.msgError),"msgSuccess"in b&&t(2,u=b.msgSuccess),"password"in b&&t(4,f=b.password),"pincode"in b&&t(5,d=b.pincode)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&256&&(s||t(8,s={props:{paths:{base:"/kit/auth",login:"/login",forgottenPassword:"/forgotten-password"}}}))},[a,l,u,o,f,d,p,g,s,_,C,M]}class ni extends tt{constructor(e){super(e),nt(this,e,ia,sn,kt,{remultKitData:8,view:3,indentifier:0,msgError:1,msgSuccess:2}),K("SvelteRegisterComponent",{component:this,tagName:"Login",options:e,id:sn.name})}get remultKitData(){throw new le("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new le("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new le("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new le("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get indentifier(){throw new le("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set indentifier(e){throw new le("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get msgError(){throw new le("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set msgError(e){throw new le("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get msgSuccess(){throw new le("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set msgSuccess(e){throw new le("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const je="src/lib/modules/auth/Page.svelte";function ri(r){let e;const t={c:function(){e=ye("Forgot your password?")},m:function(i,s){z(i,e,s)},d:function(i){i&&X(e)}};return K("SvelteRegisterBlock",{block:t,id:ri.name,type:"slot",source:"(19:10) <Link href={forgottenPasswordPath}>",ctx:r}),t}function ii(r){let e,t,n,i,s;e=new ni({props:{remultKitData:r[0]},$$inline:!0}),i=new fn({props:{href:r[2],$$slots:{default:[ri]},$$scope:{ctx:r}},$$inline:!0});const o={c:function(){we(e.$$.fragment),t=ce(),n=x("div"),we(i.$$.fragment),te(n,"class","form-footer s-NO-a_LAEXXH5"),U(n,je,19,8,549)},m:function(l,u){be(e,l,u),z(l,t,u),z(l,n,u),be(i,n,null),s=!0},p:function(l,u){const f={};u&1&&(f.remultKitData=l[0]),e.$set(f);const d={};u&4&&(d.href=l[2]),u&8&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i:function(l){s||(ie(e.$$.fragment,l),ie(i.$$.fragment,l),s=!0)},o:function(l){ae(e.$$.fragment,l),ae(i.$$.fragment,l),s=!1},d:function(l){l&&(X(t),X(n)),ve(e,l),ve(i)}};return K("SvelteRegisterBlock",{block:o,id:ii.name,type:"slot",source:"(15:6) <Route path={loginPath}>",ctx:r}),o}function si(r){let e;const t={c:function(){e=ye("Back to login")},m:function(i,s){z(i,e,s)},d:function(i){i&&X(e)}};return K("SvelteRegisterBlock",{block:t,id:si.name,type:"slot",source:"(29:10) <Link href={loginPath}>",ctx:r}),t}function oi(r){let e,t,n,i,s;e=new ur({props:{remultKitData:r[0]},$$inline:!0}),i=new fn({props:{href:r[1],$$slots:{default:[si]},$$scope:{ctx:r}},$$inline:!0});const o={c:function(){we(e.$$.fragment),t=ce(),n=x("div"),we(i.$$.fragment),te(n,"class","form-footer s-NO-a_LAEXXH5"),U(n,je,29,8,802)},m:function(l,u){be(e,l,u),z(l,t,u),z(l,n,u),be(i,n,null),s=!0},p:function(l,u){const f={};u&1&&(f.remultKitData=l[0]),e.$set(f);const d={};u&2&&(d.href=l[1]),u&8&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i:function(l){s||(ie(e.$$.fragment,l),ie(i.$$.fragment,l),s=!0)},o:function(l){ae(e.$$.fragment,l),ae(i.$$.fragment,l),s=!1},d:function(l){l&&(X(t),X(n)),ve(e,l),ve(i)}};return K("SvelteRegisterBlock",{block:o,id:oi.name,type:"slot",source:"(25:6) <Route path={forgottenPasswordPath}>",ctx:r}),o}function ai(r){let e,t;const n={c:function(){e=x("div"),t=x("small"),t.textContent="Nothing to see here",U(t,je,38,10,1001),te(e,"class","fallback s-NO-a_LAEXXH5"),U(e,je,37,8,968)},m:function(s,o){z(s,e,o),B(e,t)},p:fe,d:function(s){s&&X(e)}};return K("SvelteRegisterBlock",{block:n,id:ai.name,type:"slot",source:"(35:6) <Route fallback>",ctx:r}),n}function li(r){let e,t,n,i,s,o;e=new Ge({props:{path:r[1],$$slots:{default:[ii]},$$scope:{ctx:r}},$$inline:!0}),n=new Ge({props:{path:r[2],$$slots:{default:[oi]},$$scope:{ctx:r}},$$inline:!0}),s=new Ge({props:{fallback:!0,$$slots:{default:[ai]},$$scope:{ctx:r}},$$inline:!0});const a={c:function(){we(e.$$.fragment),t=ce(),we(n.$$.fragment),i=ce(),we(s.$$.fragment)},m:function(u,f){be(e,u,f),z(u,t,f),be(n,u,f),z(u,i,f),be(s,u,f),o=!0},p:function(u,f){const d={};f&2&&(d.path=u[1]),f&13&&(d.$$scope={dirty:f,ctx:u}),e.$set(d);const p={};f&4&&(p.path=u[2]),f&11&&(p.$$scope={dirty:f,ctx:u}),n.$set(p);const g={};f&8&&(g.$$scope={dirty:f,ctx:u}),s.$set(g)},i:function(u){o||(ie(e.$$.fragment,u),ie(n.$$.fragment,u),ie(s.$$.fragment,u),o=!0)},o:function(u){ae(e.$$.fragment,u),ae(n.$$.fragment,u),ae(s.$$.fragment,u),o=!1},d:function(u){u&&(X(t),X(i)),ve(e,u),ve(n,u),ve(s,u)}};return K("SvelteRegisterBlock",{block:a,id:li.name,type:"slot",source:"(14:4) <Route>",ctx:r}),a}function on(r){let e,t,n,i;n=new Ge({props:{$$slots:{default:[li]},$$scope:{ctx:r}},$$inline:!0});const s={c:function(){e=x("div"),t=x("div"),we(n.$$.fragment),te(t,"class","form s-NO-a_LAEXXH5"),U(t,je,14,2,444),te(e,"class","wrapper s-NO-a_LAEXXH5"),U(e,je,13,0,420)},l:function(a){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){z(a,e,l),B(e,t),be(n,t,null),i=!0},p:function(a,[l]){const u={};l&15&&(u.$$scope={dirty:l,ctx:a}),n.$set(u)},i:function(a){i||(ie(n.$$.fragment,a),i=!0)},o:function(a){ae(n.$$.fragment,a),i=!1},d:function(a){a&&X(e),ve(n)}};return K("SvelteRegisterBlock",{block:s,id:on.name,type:"component",source:"",ctx:r}),s}function sa(r,e,t){let n,i,{$$slots:s={},$$scope:o}=e;rt("Page",s,[]);let{remultKitData:a}=e;r.$$.on_mount.push(function(){a===void 0&&!("remultKitData"in e||r.$$.bound[r.$$.props.remultKitData])&&console.warn("<Page> was created without expected prop 'remultKitData'")});const l=["remultKitData"];return Object.keys(e).forEach(u=>{!~l.indexOf(u)&&u.slice(0,2)!=="$$"&&u!=="slot"&&console.warn(`<Page> was created with unknown prop '${u}'`)}),r.$$set=u=>{"remultKitData"in u&&t(0,a=u.remultKitData)},r.$capture_state=()=>({Route:Ge,Link:fn,linkHandle:un,ForgottenPassword:ur,Login:ni,remultKitData:a,loginPath:i,forgottenPasswordPath:n}),r.$inject_state=u=>{"remultKitData"in u&&t(0,a=u.remultKitData),"loginPath"in u&&t(1,i=u.loginPath),"forgottenPasswordPath"in u&&t(2,n=u.forgottenPasswordPath)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&1&&t(2,n=a.props.paths.base+a.props.paths.forgottenPassword),r.$$.dirty&1&&t(1,i=a.props.paths.base+a.props.paths.login)},[a,i,n]}class ca extends tt{constructor(e){super(e),nt(this,e,sa,on,kt,{remultKitData:0}),K("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:on.name})}get remultKitData(){throw new Error("<Page>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new Error("<Page>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{ca as default};
